{"version":3,"sources":["data/reducers.js","config.js","data/store.js","data/action.js","utils/utils.js","utils/history.js","components/BookItem.js","api/api.js","components/Recommends.js","components/SearchBox.js","components/Slides.js","pages/BookInfo.js","pages/Square.js","pages/Dashboard.js","pages/Login.js","components/SearchResult.js","pages/Library.js","pages/About.js","pages/Help.js","components/ListInfo.js","pages/Settings.js","components/ListItemLink.js","pages/Search.js","utils/asr/Authentication.js","utils/asr/WebRecorder.js","utils/asr/SpeechRecognizer.js","utils/asr/WebAudioSpeechRecognizer.js","pages/Me.js","App.js","reportWebVitals.js","index.js"],"names":["defaultState","config","ITEM_NAME","this","load","bind","save","theme_avaliable","createMuiTheme","palette","primary","main","brown","secondary","deepOrange","type","blueGrey","grey","data_default","debug","version_frontend","theme_name","api_token","user","settings_async","voice_assistant","data","theme","console","log","JSON","parse","localStorage","getItem","Error","k","e","warn","s","stringify","setItem","tasks","users","daemon","errorInfo","message","searchInfo","combineReducers","state","action","store","createStore","reducers","applyMiddleware","thunk","setConfig","dispatch","setUser","setErrorInfo","setMessage","setSearchInfo","urlEncode","param","key","encode","paramStr","t","encodeURIComponent","i","Array","getHashedQuery","URL","window","location","hash","slice","searchParams","sleep","time_ms","Promise","accept","setTimeout","isIterator","obj","Symbol","iterator","deepCopy","d","length","push","objectUpdate","origin","update","now","isChinese","temp","test","updateUsers","getState","uid","getUidUser","createHashHistory","useStyles","makeStyles","root","maxWidth","media","paddingTop","expand","transform","marginLeft","transition","transitions","create","duration","shortest","expandOpen","BookItem","props","classes","book","React","useState","expanded","setExpanded","visit","setVisit","to","Card","className","CardMedia","image","cover","title","onClick","stopPropagation","CardActions","disableSpacing","Box","style","float","Typography","variant","color","component","author","rating","value","vatiant","IconButton","clsx","aria-expanded","aria-label","Collapse","in","timeout","unmountOnExit","Container","desc","api","host","href","includes","port","api_version","api_prefix","protocol","url","access_token","refresh_token","undefined","router","method","request","get_token","set_token","refresh","access","headers","a","payload","mode","body","get_headers","Boolean","fetch","resp","js","json","error","code","status","statusText","resp2","js2","update_config","res","display","flexWrap","justifyContent","overflow","backgroundColor","background","paper","gridList","Recomends","books","setBooks","requesting","setRequesting","then","douban_top","trigger","useScrollTrigger","maxHeight","width","overflowX","Grid","container","spacing","map","v","item","xs","sm","lg","LinearProgress","requestingSearchInfo","SearchBox","onSearch","defaultValue","searchValue","setSearchValue","src","Object","keys","searchType","setSearchType","handleSearch","FormControl","fullWidth","InputLabel","Select","onChange","target","MenuItem","name","TextField","onKeyDown","Button","search_info","borderStyle","Component","UserSearch","onSelect","searchKey","setSearchKey","setUsers","user_search","List","ListItem","button","ListItemText","username","UserFriends","relations","friends","BookInfoFrame","info","convert_map","base_info","description","rating_nums","hidden_map","douban_id","created_at","douban_url","comment_number","pricing","updated_at","img_url","varian","BookDescFrame","selected_map","BookOperation","openShare","openAddList","openRecommend","setInnerState","setState","UserList","book_title","list_name","Dialog","open","onClose","DialogTitle","DialogContent","to_uid","content","CommentItem","comment","requested","setRequested","time","showInfo","moment","calendar","whiteSpace","BookCommentsAdd","input","setInput","multiline","BookComments","comments","BookInfo","recommends","requestingInfo","requestingComments","requestingRecommends","query","search","local_database","next_props","height","flexDirection","justifyItems","alignItems","Paper","SendDynamic","onRefresh","setContent","dynamic","ItemOperation","self","listItems","disabled","is_friends","nick","Square","child","square","setSquare","itemNow","setItemNow","ignoreActions","messages","book_list","all","Dashboard","paddingLeft","paddingRight","LoginFrame","password","captcha","actionType","refUsername","useRef","refPassword","actionLogin","handleAction","Divider","ref","label","current","querySelector","focus","Fade","exit","enter","Login","SmartSearchResult","abstract","cover_url","LocalDatabaseResult","SearchResult","result","smart_search","douban","Library","setResult","small","large","People","nickHead","people","profile","head","link","readmeState","leftContent","minWidth","Avatar","alt","padding","borderLeftStyle","borderLeftWidth","borderLeftColor","About","Help","ListInfo","keyNames","openChild","setOpenChild","setChild","childTitle","setChildTitle","showName","ListItemSecondaryAction","Settings","themeName","setThemeName","resetSettingsOpen","setResetSettingsOpen","deleteDataOpen","setDeleteDataOpen","openUser","setOpenUser","resetSettings","c","ListSubheader","reload","Switch","defaultChecked","checked","phone","DialogActions","ListItemLink","icon","renderLink","useMemo","forwardRef","itemProps","ListItemIcon","Search","startedSearching","setStartedSearching","setDefaultValue","signCallback","signStr","secretKey","tencentConfig","secretkey","bytes","fileData","dataString","String","fromCharCode","Uint8ArrayToString","wordArray","words","sigBytes","u8","Uint8Array","toUint8Array","CryptoJS","HmacSHA1","btoa","WebRecorder","instance","audioContext","stream","OnError","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","AudioContext","webkitAudioContext","resume","mediaDevices","audio","video","getAudioSuccess","catch","getAudioFail","userAgent","toLowerCase","match","indexOf","close","mediaStreamSource","createMediaStreamSource","scriptProcessor","createScriptProcessor","onaudioprocess","audioData","dataLength","dataBuffer","ArrayBuffer","dataView","DataView","offset","Math","max","min","setInt16","to16BitPCM","Float32Array","fitCount","round","newData","springFactor","tmp","before","floor","toFixed","after","ceil","atPoint","to16kHz","inputBuffer","getChannelData","OnReceivedData","buffer","connect","destination","err","stop","suspend","getTracks","val","NewCredential","appid","secretid","params","strParam","sort","getServerTime","resolve","reject","xhr","XMLHttpRequest","send","onreadystatechange","readyState","responseText","Date","getTime","guid","replace","r","random","toString","serverTime","engine_model_type","parseInt","hasOwnProperty","voice_format","hotword_id","needvad","filter_dirty","filter_modal","filter_punc","convert_num_mode","word_info","vad_silence_time","createQuery","queryStr","formatSignString","SpeechRecognizer","socket","isSignSuccess","isSentenceBegin","isRecognizeComplete","asr","getSignStr","getUrl","WebSocket","MozWebSocket","onopen","onmessage","response","OnRecognitionStart","final","OnRecognitionComplete","voice_id","slice_type","OnSentenceBegin","OnSentenceEnd","OnRecognitionResultChange","onerror","onclose","event","WebAudioSpeechRecognizer","recorder","speechRecognizer","isCanSendData","write","start","UserBaseInfo","SendMessage","useReducer","x","forceUpdate","MyBookLists","bookLists","setBookLists","book_lists","bookList","Me","receivedMessages","setReceivedMessages","sentMessages","setSentMessages","requestedMyMessages","setRequestedMyMessages","queryList","q","parseHashedQuery","message_to","toUid","setToUid","received","sent","messagesList","drawerWidth","appBar","zIndex","drawer","easing","sharp","leavingScreen","flexGrow","appBarShift","enteringScreen","menuButton","marginRight","hide","flexShrink","drawerOpen","drawerClose","breakpoints","up","toolbar","mixins","subscribers","last_data","subscribe","subFunc","recStarted","tbpStarted","App","useTheme","setOpen","errorDialogInfo","setErrorDialogInfo","myMessage","setMyMessage","terminalId","setTerminalId","useEffect","onWindowResize","innerWidth","addEventListener","removeEventListener","assistantStart","started","recParams","rec","onSentenceEnd","startMessage","updateMessage","voice_text_str","setupRecorder","text","hideMessage","blocked","tid","terminal_id","tbp","ResponseMessage","GroupList","textAll","Content","tts","Audio","autoplay","oncanplaythrough","play","atob","DialogStatus","SlotInfoList","slot","SlotName","SlotValue","routerContent","CssBaseline","AppBar","position","Toolbar","edge","noWrap","Drawer","direction","path","exact","ThemeProvider","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","Fragment","size","fontSize","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","cycle","load_from_config","ReactDOM","render","document","getElementById","startFunc","cycleFunc"],"mappings":"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","file":"static/js/main.1162d4be.chunk.js","sourcesContent":["import { combineReducers } from 'redux'\r\nimport Config from \"../config\"\r\n\r\nconst defaultState = {\r\n  config: new Config(),\r\n  tasks: [],\r\n  user: null,\r\n  users: {},\r\n  daemon: null,\r\n  errorInfo: null,\r\n  message: null,\r\n  searchInfo: null\r\n}\r\n\r\nfunction config(state = defaultState.config, action) {\r\n  switch (action.type) {\r\n    case \"SET_CONFIG\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction user(state = defaultState.user, action) {\r\n  switch (action.type) {\r\n    case \"SET_USER\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction users(state = defaultState.users, action) {\r\n  switch (action.type) {\r\n    case \"SET_USERS\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction tasks(state = defaultState.tasks, action) {\r\n  switch (action.type) {\r\n    case \"SET_TASKS\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction daemon(state = defaultState.daemon, action) {\r\n  switch (action.type) {\r\n    case \"SET_DAEMON\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction errorInfo(state = defaultState.errorInfo, action) {\r\n  switch (action.type) {\r\n    case \"SET_ERROR_INFO\":\r\n      // console.log('SET_ERROR_INFO', action.data);\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction message(state = defaultState.message, action) {\r\n  switch (action.type) {\r\n    case \"SET_MESSAGE\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction searchInfo(state = defaultState.searchInfo, action) {\r\n  switch (action.type) {\r\n    case \"SET_SEARCH_INFO\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default combineReducers({ config, errorInfo, message, daemon, user, users, tasks, searchInfo });\r\n","import { createMuiTheme, makeStyles, ThemeProvider } from '@material-ui/core/styles';\r\nimport { orange, grey, blueGrey, deepOrange, brown } from '@material-ui/core/colors';\r\n\r\nclass Config {\r\n  ITEM_NAME = \"mayne_config\";\r\n  constructor() {\r\n    this.load = this.load.bind(this);\r\n    this.save = this.save.bind(this);\r\n    this.theme_avaliable = {\r\n      \"默认主题\": createMuiTheme({\r\n        palette: {\r\n          primary: {\r\n            main: brown[500],\r\n          },\r\n          secondary: {\r\n            main: deepOrange[500],\r\n          },\r\n        },\r\n      }),\r\n      '黑暗模式': createMuiTheme({\r\n        palette: {\r\n          type: \"dark\",\r\n          primary: {\r\n            main: blueGrey[500],\r\n          },\r\n          secondary: {\r\n            main: grey[500],\r\n          },\r\n        },\r\n      }),\r\n    }\r\n    // 在构造函数执行的时候加载保存的数据\r\n    this.data_default = {\r\n      debug: false,\r\n      version_frontend: 0.1,\r\n      // 显示主题\r\n      // theme_name: \"黑暗模式\",\r\n      theme_name: \"默认主题\",\r\n      theme_avaliable: [\r\n        '默认主题',\r\n        '黑暗模式'\r\n      ],\r\n      api_token: {},\r\n      // 用户信息\r\n      user: null,\r\n      // 设置同步\r\n      settings_async: true,\r\n      voice_assistant: true\r\n    };\r\n    this.data = this.data_default;\r\n    this.theme = this.theme_avaliable[\"默认主题\"];\r\n    this.load();\r\n  }\r\n\r\n  load() {\r\n    console.log(\"Config: loading config...\");\r\n    if (this.data.debug) {\r\n      console.log(\"Config: load default config.\");\r\n      this.save();\r\n    }\r\n    try {\r\n      this.data = JSON.parse(localStorage.getItem(this.ITEM_NAME));\r\n      if (!this.data) throw new Error(\"Null data\");\r\n      console.log(\"Got data:\", this.data);\r\n      if (!this.data.version_frontend || this.data.version_frontend < this.data_default.version_frontend) {\r\n        // 版本升级，增量更新\r\n        console.log(`Config: update ${this.data.version_frontend} -> ${this.data_default.version_frontend}`);\r\n        this.data.version_frontend = this.data_default.version_frontend;\r\n        for (let k in this.data_default) {\r\n          if (!this.data[k]) {\r\n            console.log(`    Config: add value ${k}`);\r\n            this.data[k] = this.data_default[k];\r\n          }\r\n        }\r\n        this.save();\r\n      }\r\n    } catch (e) {\r\n      console.warn(`Can not find ${this.ITEM_NAME} in localStorage, use default config.`);\r\n      this.data = this.data_default;\r\n      this.save();\r\n    }\r\n    this.theme = this.theme_avaliable[this.data.theme_name];\r\n    if (!this.theme) this.theme = this.theme_avaliable[\"default\"];\r\n  }\r\n\r\n  save() {\r\n    console.log(\"Config: saving config...\");\r\n    const s = JSON.stringify(this.data);\r\n    localStorage.setItem(this.ITEM_NAME, s);\r\n    return s;\r\n  }\r\n};\r\n\r\nexport default Config;","// applyMiddleware: redux通过该函数来使用中间件\r\n// createStore: 用于创建store实例\r\nimport { applyMiddleware, createStore } from 'redux'\r\n\r\n// 中间件，作用：如果不使用该中间件，当我们dispatch一个action时，需要给dispatch函数传入action        \r\n// 对象；但如果我们使用了这个中间件，那么就可以传入一个函数，这个函数接收两个参数:dispatch和    \r\n// getState。这个dispatch可以在将来的异步请求完成后使用，对于异步action很有用\r\nimport thunk from 'redux-thunk'\r\n\r\n// 引入reducer\r\nimport reducers from './reducers.js'\r\n\r\n// 创建store实例\r\nlet store = createStore(\r\n    reducers,\r\n    applyMiddleware(thunk)\r\n)\r\nexport default store","export function setConfig(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_CONFIG\", data: data });\r\n  };\r\n}\r\n\r\nexport function setTasks(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_TASKS\", data: data });\r\n  };\r\n}\r\n\r\nexport function setUser(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_USER\", data: data });\r\n  };\r\n}\r\n\r\nexport function setUsers(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_USERS\", data: data });\r\n  };\r\n}\r\n\r\nexport function setDaemon(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_DAEMON\", data: data });\r\n  };\r\n}\r\n\r\nexport function setErrorInfo(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_ERROR_INFO\", data: data });\r\n  };\r\n}\r\n\r\nexport function setMessage(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_MESSAGE\", data: data });\r\n  };\r\n}\r\n\r\nexport function setSearchInfo(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_SEARCH_INFO\", data: data });\r\n  };\r\n}\r\n\r\n","import moment from 'moment';\r\nimport 'moment/locale/zh-cn'\r\nimport { setUsers } from '../data/action';\r\nimport store from '../data/store';\r\n\r\nexport function isMobileDevice() {\r\n  const sUserAgent = navigator.userAgent;\r\n  return (sUserAgent.indexOf('Android') > -1 || sUserAgent.indexOf('iPhone') > -1 || sUserAgent.indexOf('iPad') > -1 || sUserAgent.indexOf('iPod') > -1 || sUserAgent.indexOf('Symbian') > -1);\r\n}\r\n\r\n/** \r\n* param 将要转为URL参数字符串的对象 \r\n* key URL参数字符串的前缀 \r\n* encode true/false 是否进行URL编码,默认为true \r\n*  \r\n* return URL参数字符串 \r\n*/\r\nexport function urlEncode(param, key, encode) {\r\n  if (param == null) return '';\r\n  var paramStr = '';\r\n  var t = typeof (param);\r\n  if (t === 'string' || t === 'number' || t === 'boolean') {\r\n    paramStr += '&' + key + '=' + ((encode == null || encode) ? encodeURIComponent(param) : param);\r\n  } else {\r\n    for (var i in param) {\r\n      var k = key == null ? i : key + (param instanceof Array ? '[' + i + ']' : '.' + i);\r\n      paramStr += urlEncode(param[i], k, encode);\r\n    }\r\n  }\r\n  return paramStr;\r\n};\r\n\r\nexport function urlEncode2(obj) {\r\n  try {\r\n    return JSON.stringify(obj).replace(/:/g, \"=\").replace(/\"/g, '').replace(/,/g, '&').match(/\\{([^)]*)\\}/)[1];\r\n  } catch (e) {\r\n    console.error(e);\r\n    return \"\";\r\n  }\r\n}\r\n\r\nexport function getHashedQuery() {\r\n  return [...new URL('http://localhost' + window.location.hash.slice(1)).searchParams];\r\n}\r\n\r\nexport function parseHashedQuery() {\r\n  const queryList = getHashedQuery();\r\n  let query = {};\r\n  for (const q of queryList) {\r\n    query[q[0]] = q[1];\r\n  }\r\n  return query;\r\n}\r\n\r\nexport function parseTimePoint(time) {\r\n  return moment(time).format('LLLL');\r\n}\r\n\r\nexport function parseTime(time) {\r\n  return moment(time).calendar();\r\n}\r\n\r\nexport function parseTimePeriod(time) {\r\n  return moment.duration(time).humanize();\r\n}\r\n\r\nexport function getTextFieldValue(el) {\r\n  return el.current.childNodes[el.current.childElementCount - 1].childNodes[0].value;\r\n}\r\n\r\nexport function sleep(time_ms) {\r\n  return new Promise(accept => {\r\n    setTimeout(accept, time_ms);\r\n  });\r\n}\r\n\r\n// // 设置到本周的星期几\r\n// Date.prototype.setDay = function (day) {\r\n//   let day_ = this.getDay();\r\n//   if (day_ === day) return this;\r\n//   this.setTime(this.getTime() + 1000 * 60 * 60 * 24 * (day - day_));\r\n//   return this;\r\n// };\r\n\r\n// // 获取 YYYY-MM-DD 格式\r\n// Date.prototype.toDateString = function () {\r\n//   return this.toISOString().slice(0, 10);\r\n// };\r\n\r\n// export function cutString(str, length=10)\r\n\r\nexport function isIterator(obj) {\r\n  return obj != null && typeof obj[Symbol.iterator] === 'function';\r\n}\r\n\r\n// 下载文件方法\r\nexport function funDownload(content, filename) {\r\n  var eleLink = document.createElement('a');\r\n  eleLink.download = filename;\r\n  eleLink.style.display = 'none';\r\n  // 字符内容转变成blob地址\r\n  var blob = new Blob([content]);\r\n  eleLink.href = URL.createObjectURL(blob);\r\n  // 触发点击\r\n  document.body.appendChild(eleLink);\r\n  eleLink.click();\r\n  // 然后移除\r\n  document.body.removeChild(eleLink);\r\n};\r\n\r\n\r\nexport function deepCopy(data) {\r\n  if (isIterator(data) && typeof (data) !== \"string\") {\r\n    let d = [];\r\n    for (let i = 0; i < data.length; i++) {\r\n      d.push(data[i]);\r\n    }\r\n    return d;\r\n  } else if (typeof (data) === \"object\") {\r\n    let d = {};\r\n    for (const k in data) {\r\n      d[k] = deepCopy(data[k]);\r\n    }\r\n    return d;\r\n  } else {\r\n    return data;\r\n  }\r\n}\r\n\r\nexport function objectUpdate(origin, update) {\r\n  let now = deepCopy(origin);\r\n  for (const k in update) {\r\n    now[k] = update[k];\r\n  }\r\n  return now;\r\n}\r\n\r\nexport function isChinese(temp) {\r\n  var re = /[^\\u4E00-\\u9FA5]/;\r\n  if (re.test(temp)) return false;\r\n  return true;\r\n}\r\n\r\nexport function getRandomInt(start, stop) {\r\n  return Math.floor(Math.random() * (stop - start)) + start;\r\n}\r\n\r\nexport function shuffle(arr) {\r\n  let _arr = arr.slice();\r\n  //slice不会影响原来的数组，但是splice就会影响原来的arr数组\r\n  for (let i = 0; i < _arr.length; i++) {\r\n    let j = getRandomInt(0, i);\r\n    let t = _arr[i];\r\n    _arr[i] = _arr[j];\r\n    _arr[j] = t;\r\n  }\r\n  return _arr;\r\n}\r\n\r\nexport function updateUsers(user) {\r\n  let users = store.getState().users;\r\n  users[user.uid] = user;\r\n  store.dispatch(setUsers(users));\r\n}\r\n\r\nexport function getUidUser(uid) {\r\n  const users = store.getState().users;\r\n  return users[uid];\r\n}","import { createBrowserHistory, createHashHistory } from 'history';\r\n// import createHistory from 'history/lib/createHashHistory';\r\n\r\nexport default createHashHistory();\r\n// export default createBrowserHistory();","import React from 'react';\r\nimport clsx from 'clsx';\r\nimport { Box, Card, CardActions, CardContent, CardHeader, CardMedia, Collapse, Container, IconButton, makeStyles, Menu, MenuItem, Typography } from \"@material-ui/core\";\r\nimport MoreVertIcon from '@material-ui/icons/MoreVert';\r\nimport ShareIcon from '@material-ui/icons/Share';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport FavoriteIcon from '@material-ui/icons/Favorite';\r\nimport { urlEncode } from '../utils/utils';\r\nimport history from '../utils/history';\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    maxWidth: 345,\r\n  },\r\n  media: {\r\n    // height: 0,\r\n    // paddingTop: '56.25%', // 16:9\r\n    paddingTop: '100%'\r\n  },\r\n  expand: {\r\n    transform: 'rotate(0deg)',\r\n    marginLeft: 'auto',\r\n    transition: theme.transitions.create('transform', {\r\n      duration: theme.transitions.duration.shortest,\r\n    }),\r\n  },\r\n  expandOpen: {\r\n    transform: 'rotate(180deg)',\r\n  },\r\n}));\r\n\r\n\r\nexport default function BookItem(props) {\r\n  const classes = useStyles();\r\n  const { book } = props;\r\n  const [expanded, setExpanded] = React.useState(false);\r\n  const [anchorEl, setAnchorEl] = React.useState(null);\r\n  const [visit, setVisit] = React.useState(null);\r\n  if (visit) {\r\n    return <Redirect to={visit}></Redirect>;\r\n  }\r\n  return (<Card className={classes.root}>\r\n    {/* <CardHeader\r\n      action={\r\n        <Box>\r\n          <IconButton onClick={(e) => setAnchorEl(e.currentTarget)}>\r\n            <MoreVertIcon />\r\n          </IconButton>\r\n          <Menu\r\n            open={Boolean(anchorEl)}\r\n            onClose={() => setAnchorEl(null)}\r\n            anchorEl={anchorEl}>\r\n            <MenuItem>删除</MenuItem>\r\n          </Menu>\r\n        </Box>\r\n      }\r\n      title={book.title}\r\n      subheader={book.author}\r\n    /> */}\r\n    <CardMedia\r\n      className={classes.media}\r\n      image={book.cover ? book.cover : \"https://img2.doubanio.com/view/subject/m/public/s19120153.jpg\"}\r\n      title={book.title}\r\n      onClick={(e) => {\r\n        e.stopPropagation();\r\n        console.log('to visit title:', book.title);\r\n        // history.push({ pathname: \"/book_info\", search: '?' + urlEncode({ title: book.title }).slice(1) });\r\n        setVisit(`/book_info?title=${book.title}`);\r\n      }}\r\n    >\r\n    </CardMedia>\r\n    {/* <CardContent>\r\n      \r\n    </CardContent> */}\r\n    <CardActions disableSpacing onClick={() => { setExpanded(!expanded); }}>\r\n      <Box style={{ float: \"left\" }}>\r\n        <Typography variant=\"h6\" color=\"textPrimary\" component=\"p\" onClick={(e) => {\r\n          e.stopPropagation();\r\n          console.log('to visit title:', book.title);\r\n        }}>\r\n          {book.title}\r\n        </Typography>\r\n        <Typography variant=\"h6\" color=\"textSecondary\" component=\"p\" onClick={(e) => {\r\n          e.stopPropagation();\r\n          console.log('to visit author:', book.author);\r\n        }}>\r\n          {book.author}\r\n        </Typography>\r\n        {book.rating && (book.rating.value === 0 ? null : 1) && book.rating.value && <Typography vatiant=\"body2\" color=\"textSecondary\">{book.rating.value}分</Typography>}\r\n      </Box>\r\n      <IconButton\r\n        className={clsx(classes.expand, {\r\n          [classes.expandOpen]: expanded,\r\n        })}\r\n        onClick={() => { setExpanded(!expanded); }}\r\n        aria-expanded={expanded}\r\n        aria-label=\"show more\"\r\n      >\r\n        <ExpandMoreIcon />\r\n      </IconButton>\r\n    </CardActions>\r\n    <Collapse in={expanded} timeout=\"auto\" unmountOnExit>\r\n      <Container>\r\n        <Typography variant=\"body2\" color=\"textSecondary\" component=\"p\">\r\n          {book.desc}\r\n        </Typography>\r\n        <IconButton>\r\n          <FavoriteIcon />\r\n        </IconButton>\r\n        <IconButton>\r\n          <ShareIcon />\r\n        </IconButton>\r\n      </Container>\r\n    </Collapse>\r\n  </Card>);\r\n};","import { setConfig, setErrorInfo, setUser } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { isIterator, urlEncode } from \"../utils/utils\"\r\n\r\n\r\n\r\nclass API {\r\n  constructor() {\r\n    // this.host = window.location.href.includes(\"localhost\") ? \"localhost\" : \"pc.chiro.work\";\r\n    // this.port = 8080;\r\n    // this.api_version = \"v1\";\r\n    // this.api_prefix = `/api/${this.api_version}`;\r\n    // this.protocol = 'http'\r\n    // this.url = this.host ? `${this.protocol}://${this.host}:${this.port}${this.api_prefix}` : `${this.api_prefix}`;\r\n    // this.access_token = '';\r\n    // this.refresh_token = '';\r\n\r\n    this.host = window.location.href.includes(\"localhost\") ? \"localhost\" : null;\r\n    this.port = 443;\r\n    this.api_version = \"v1\";\r\n    this.api_prefix = `/api/${this.api_version}`;\r\n    this.protocol = 'https'\r\n    this.url = this.host ? `${this.protocol}://${this.host}:${this.port}${this.api_prefix}` : `${this.api_prefix}`;\r\n    this.access_token = '';\r\n    this.refresh_token = '';\r\n  }\r\n  set_token(access_token, refresh_token) {\r\n    // this.access_token = access_token || this.access_token;\r\n    // this.refresh_token = refresh_token || this.refresh_token;\r\n    if (access_token !== undefined)\r\n      this.access_token = access_token;\r\n    if (refresh_token !== undefined)\r\n      this.refresh_token = refresh_token;\r\n  }\r\n  get_token() {\r\n    return {\r\n      access_token: this.access_token === '' ? undefined : this.access_token, refresh_token: this.refresh_token === '' ? undefined : this.refresh_token\r\n    }\r\n  }\r\n  request_key(router, key, method = \"GET\", data) {\r\n    return this.request(`${router}/${key}`, method, data);\r\n  }\r\n  update_config() {\r\n    let config = store.getState().config;\r\n    config.data.api_token = this.get_token();\r\n    console.log('config.data.api_token', config.data.api_token)\r\n    config.save();\r\n    store.dispatch(setConfig(config));\r\n  }\r\n  load_from_config() {\r\n    const config = store.getState().config;\r\n    this.set_token(config.data.api_token.access_token, config.data.api_token.refresh_token);\r\n  }\r\n  get_headers(refresh = false, access = true) {\r\n    let headers = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    if (refresh) {\r\n      headers['Refresh'] = this.refresh_token;\r\n    }\r\n    if (access) {\r\n      if (this.access_token !== '') headers['Authorization'] = this.access_token;\r\n    }\r\n    return headers;\r\n  }\r\n  async request(router, method = \"GET\", data) {\r\n    const payload = {\r\n      method: method,\r\n      mode: 'cors',\r\n      // GET Body 不带数据\r\n      body: method === 'GET' ? undefined : (data ? JSON.stringify(data) : undefined),\r\n      // 注销的时候自带 refresh_token\r\n      headers: this.get_headers(Boolean(router === 'session' && method === 'DELETE')),\r\n    };\r\n    // console.log('request', router, method, data, payload);\r\n    const url = (method !== 'GET' || !data) ? `${this.url}/${router}` : `${this.url}/${router}?${urlEncode(data).slice(1)}`;\r\n    // console.log('url', url);\r\n    const resp = await fetch(url, payload);\r\n    let js = null;\r\n    try { js = await resp.json(); } catch (e) {\r\n      console.error(e);\r\n      store.dispatch(setErrorInfo(e));\r\n      return { code: resp.status, error: resp.statusText };\r\n    }\r\n    console.log('raw js:', js);\r\n    if (!js) {\r\n      // console.log(await resp.json());\r\n      js = {};\r\n      js.message = resp.statusText;\r\n    }\r\n    if (js.code === undefined) js.code = resp.status;\r\n    if (js.code === 422) {\r\n      if (this.refresh_token === '') {\r\n        // 过期勒\r\n        return null;\r\n      }\r\n      // ac_token到期，准备更新\r\n      // console.log(this.get_headers(true));\r\n      const resp2 = await fetch(`${this.url}/session`, {\r\n        method: 'GET',\r\n        mode: 'cors',\r\n        headers: this.get_headers(true),\r\n        // body: JSON.stringify({ refresh_token: this.refresh_token })\r\n      });\r\n      try {\r\n        const js2 = await resp2.json();\r\n        // console.log('updating ac_token', js2);\r\n        if (js2.code === 200) {\r\n          this.set_token(js2.data.access_token, js2.data.refresh_token);\r\n          this.update_config();\r\n          // 更新user\r\n          const res = this.request('user', 'GET');\r\n          if (res.code === 200) {\r\n            store.dispatch(setUser(res.data.user));\r\n          }\r\n        }\r\n        else {\r\n          // 判定为 update_token 也过期，要求重新登录\r\n          store.dispatch(setErrorInfo(\"登录过期，请重新登录\"));\r\n          return null;\r\n        }\r\n      } catch (e) {\r\n        // console.error(e);\r\n        return { code: resp2.status, error: resp2.statusText };\r\n      }\r\n      return this.request(router, method, data);\r\n    }\r\n    if (js.code === 200) {\r\n      // 登录自动储存 JWT 数据\r\n      if (router === 'session' && method === 'POST') {\r\n        const { access_token, refresh_token } = js.data;\r\n        // console.log('jwt', access_token, refresh_token);\r\n        this.set_token(access_token, refresh_token);\r\n        this.update_config();\r\n      } else if (router === 'session' && method === 'DELETE') {\r\n        // 注销\r\n        // console.warn('注销');\r\n        this.set_token('', '');\r\n        this.update_config();\r\n      }\r\n    } else {\r\n      store.dispatch(setErrorInfo(js));\r\n    }\r\n    return js;\r\n  }\r\n}\r\n\r\nconst api = new API();\r\n\r\nexport { API, api };","import React from 'react';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport GridList from '@material-ui/core/GridList';\r\nimport GridListTile from '@material-ui/core/GridListTile';\r\nimport GridListTileBar from '@material-ui/core/GridListTileBar';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport InfoIcon from '@material-ui/icons/Info';\r\nimport BookItem from \"../components/BookItem\";\r\nimport { Box, Button, Grid, LinearProgress, Typography, useScrollTrigger } from '@material-ui/core';\r\nimport { api } from '../api/api';\r\nimport { setErrorInfo } from '../data/action';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex',\r\n    flexWrap: 'wrap',\r\n    justifyContent: 'space-around',\r\n    overflow: 'hidden',\r\n    backgroundColor: theme.palette.background.paper,\r\n  },\r\n  gridList: {\r\n    // width: 500,\r\n    // height: 450,\r\n  },\r\n}));\r\n\r\n\r\nexport default function Recomends() {\r\n  const classes = useStyles();\r\n  // const books = [\r\n  //   {\r\n  //     title: \"fangguojieryuan\",\r\n  //     author: \"haha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  //   {\r\n  //     title: \"fangguojieryuan2\",\r\n  //     author: \"ha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  //   {\r\n  //     title: \"fangguojieryuan\",\r\n  //     author: \"ha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  //   {\r\n  //     title: \"fangguojieryuan2\",\r\n  //     author: \"ha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  //   {\r\n  //     title: \"fangguojieryuan\",\r\n  //     author: \"ha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  //   {\r\n  //     title: \"fangguojieryuan2\",\r\n  //     author: \"ha\",\r\n  //     desc: \"a small book\",\r\n  //     cover: \"https://material-ui.com/static/images/grid-list/star.jpg\"\r\n  //   },\r\n  // ];\r\n  const [books, setBooks] = React.useState([]);\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  if (!requesting) {\r\n    setRequesting(true);\r\n    api.request('douban_top').then(resp => {\r\n      if (resp.code !== 200) {\r\n        setErrorInfo(resp);\r\n      } else {\r\n        setRequesting(true);\r\n        setBooks(resp.data.douban_top);\r\n      }\r\n    })\r\n  }\r\n  const trigger = useScrollTrigger();\r\n  if (trigger) { console.log(\"Slide to bottom\"); }\r\n  return (<Box>\r\n    <br />\r\n    <Typography variant=\"h4\">好书推荐</Typography>\r\n    <br />\r\n    <div style={{ maxHeight: 320, overflow: 'auto', width: \"100%\", overflowX: \"hidden\" }}>\r\n      <Grid container spacing={3}>\r\n        {books.map((v, k) => {\r\n          return <Grid key={k} item xs={6} sm={4} lg={3}><BookItem book={v}></BookItem></Grid>;\r\n        })}\r\n      </Grid>\r\n    </div>\r\n    <br></br>\r\n    <LinearProgress color=\"secondary\" style={{ display: (trigger ? \"block\" : \"none\") }}></LinearProgress>\r\n  </Box>);\r\n};","import React from 'react';\r\nimport { Button, Container, Divider, FormControl, Grid, InputLabel, MenuItem, Select, TextField, Typography } from \"@material-ui/core\";\r\nimport Recomends from \"./Recommends\";\r\nimport { api } from \"../api/api\";\r\nimport store from '../data/store';\r\nimport { setSearchInfo } from '../data/action';\r\n\r\nlet requestingSearchInfo = false;\r\nif (!store.getState().searchInfo && !requestingSearchInfo) {\r\n  (async () => {\r\n    requestingSearchInfo = true;\r\n    const resp = await api.request('search', 'PATCH');\r\n    store.dispatch(setSearchInfo(resp.data.search_info));\r\n    requestingSearchInfo = false;\r\n  })();\r\n}\r\n\r\n\r\nexport default function SearchBox(props) {\r\n  const { onSearch, defaultValue } = props;\r\n  const searchInfo = store.getState().searchInfo;\r\n  const [searchValue, setSearchValue] = React.useState(defaultValue ? (defaultValue.key ? defaultValue.key : '') : '');\r\n  const [searchType, setSearchType] = React.useState(searchInfo ? (defaultValue ? defaultValue.src : Object.keys(searchInfo)[0]) : null);\r\n  const handleSearch = () => {\r\n    if (!onSearch) return;\r\n    onSearch(searchValue, searchType, searchInfo);\r\n  };\r\n  return (\r\n    <Grid container spacing={3}>\r\n      {/* <Grid item xs={2}></Grid> */}\r\n      {/* <Grid item xs={2}> */}\r\n      <Grid item xs={4}>\r\n        <FormControl fullWidth>\r\n          <InputLabel>搜索类型</InputLabel>\r\n          <Select\r\n            value={searchType}\r\n            onChange={(e) => {\r\n              setSearchType(e.target.value);\r\n            }}\r\n          >\r\n            {searchInfo ? Object.keys(searchInfo).map((k, v) => {\r\n              return <MenuItem key={v} value={k}>{searchInfo[k].name}</MenuItem>\r\n            }) : <MenuItem>正在加载</MenuItem>}\r\n          </Select>\r\n        </FormControl>\r\n      </Grid>\r\n      {/* <Grid item xs={5}> */}\r\n      <Grid item xs={6}>\r\n        <TextField fullWidth\r\n          onChange={e => setSearchValue(e.target.value)}\r\n          onKeyDown={e => {\r\n            if (e.key === 'Enter') handleSearch();\r\n          }}\r\n          value={searchValue}></TextField>\r\n      </Grid>\r\n      {/* <Grid item xs={1}> */}\r\n      <Grid item xs={2}>\r\n        <Button variant=\"contained\" color=\"primary\" onClick={handleSearch}>搜索</Button>\r\n      </Grid>\r\n      {/* <Grid item xs={2}></Grid>\r\n      <Grid item xs={6}></Grid> */}\r\n    </Grid>);\r\n};","\r\nimport React, { useEffect, moment } from \"react\";\r\nimport { Box, Button, makeStyles, Paper, Slide } from \"@material-ui/core\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    borderStyle: 'dotted',\r\n  }\r\n}))\r\nvar i = -1;\r\n// export default function Slides(props) {\r\n//   const images = [\r\n//     'https://img3.doubanio.com/lpic/s24223015.jpg', 'https://material-ui.com/static/images/grid-list/vegetables.jpg', 'https://material-ui.com/static/images/grid-list/star.jpg'\r\n//   ]\r\n//   const [imageIndex, setImage] = React.useState(images[0]);\r\n//   setTimeout(() => {\r\n//     i++;\r\n//     setImage(images[i]);\r\n//     if (i == images.length - 1) {\r\n//       i = -1;\r\n//     }\r\n//   }, 10000);\r\n//   /*setInterval(function() { \r\n//     for(var i=0;i<images.length;i++)\r\n//     {setImage(images[i])\r\n//     if(i===images.length-1)\r\n//     i=0;\r\n//   }\r\n//  },4000);*/\r\n//   return (<Paper>\r\n//     <img src={imageIndex}></img>\r\n//     <Box style={{ display: \"flex\" }}>\r\n//       {images.map((v, k) => <Button key={k} onClick={() => { setImage(images[k]) }}>{k}</Button>)}\r\n//     </Box>\r\n//   </Paper>);\r\n// }\r\n\r\n\r\nexport default class Slides extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.refresh = this.refresh.bind(this);\r\n    this.images = [\r\n      'https://material-ui.com/static/images/grid-list/breakfast.jpg',\r\n      'https://material-ui.com/static/images/grid-list/vegetables.jpg',\r\n      'https://material-ui.com/static/images/grid-list/star.jpg'\r\n    ]\r\n    this.state = {\r\n      imageIndex: 0,\r\n      imageLastIndex: this.images.length - 1,\r\n      sliding: false,\r\n      clickOnSliding: false\r\n    };\r\n    this.slidesRunning = null;\r\n    this.refreshTime = 1000;\r\n  }\r\n  refresh() {\r\n    if (!this.slidesRunning) return;\r\n    // console.log('refresh');\r\n    const k = (this.state.imageIndex === this.images.length - 1) ? 0 : (this.state.imageIndex + 1);\r\n    this.setState({ imageIndex: k, imageLastIndex: this.state.imageIndex, sliding: true });\r\n    setTimeout(() => {\r\n      if (this.state.clickOnSliding) return;\r\n      this.setState({ sliding: false });\r\n    }, 12000);\r\n    setTimeout(this.refresh, this.refreshTime);\r\n  }\r\n  componentDidMount() {\r\n    // console.log('componentDidMount');\r\n    this.slidesRunning = true;\r\n    setTimeout(this.refresh, this.refreshTime);\r\n  }\r\n  componentWillUnmount() {\r\n    // console.log('componentWillUnmount');\r\n    this.slidesRunning = false;\r\n  }\r\n  render() {\r\n    return <Paper>\r\n      <Box>\r\n        <img src={this.images[this.state.imageIndex]}></img>\r\n      </Box>\r\n      {/* <Slide direction={!this.state.sliding ? \"left\" : \"right\"} in={!this.state.sliding} timeout={{ enter: 500, exit: 500 }} mountOnEnter unmountOnExit>\r\n        <img style={{ height: 300, width: \"100%\" }} src={this.images[this.state.sliding ? this.state.imageLastIndex : this.state.imageIndex]}></img>\r\n      </Slide> */}\r\n      {/* <Slide direction={this.state.sliding ? \"left\" : \"right\"} in={this.state.sliding} timeout={{ enter: 500, exit: 500 }} mountOnEnter unmountOnExit>\r\n        <img src={this.images[this.state.imageLastIndex]}></img>\r\n      </Slide> */}\r\n      <Box style={{ display: \"flex\", justifyContent: \"center\" }}>\r\n        {this.images.map((v, k) => <Button key={k} onClick={() => { this.setState({ imageIndex: k }) }}>{k}</Button>)}\r\n      </Box>\r\n    </Paper >\r\n  }\r\n}","import { Button, Container, Dialog, DialogContent, DialogTitle, Grid, IconButton, List, ListItem, ListItemText, Paper, TextField, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport ShareIcon from '@material-ui/icons/Share';\r\nimport PlaylistAddIcon from '@material-ui/icons/PlaylistAdd';\r\nimport ContactMailIcon from '@material-ui/icons/ContactMail';\r\nimport { api } from '../api/api';\r\nimport { getHashedQuery, getUidUser, objectUpdate, parseTime, updateUsers } from \"../utils/utils\";\r\nimport store from \"../data/store\";\r\nimport { setMessage } from \"../data/action\";\r\n\r\nfunction UserSearch(props) {\r\n  const { onSelect } = props;\r\n  const [searchKey, setSearchKey] = React.useState(\"\");\r\n  const [users, setUsers] = React.useState(null);\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  if (!requesting) {\r\n    setRequesting(true);\r\n    api.request('user_info', \"GET\", { key: searchKey }).then(resp => {\r\n      setRequesting(true);\r\n      setUsers(resp.data.user_search);\r\n    });\r\n  }\r\n  return <div>\r\n    <List>\r\n      {users && users.map((user, v) => <ListItem button key={user.uid} onClick={() => {\r\n        onSelect && onSelect(user);\r\n      }}>\r\n        {/* <Typography variant=\"body1\" color=\"primary\">{user.username}</Typography> */}\r\n        <ListItemText primary={user.username}></ListItemText>\r\n      </ListItem>)}\r\n    </List>\r\n    <TextField value={searchKey} fullWidth onChange={e => setSearchKey(e.target.value)} variant=\"outlined\"></TextField>\r\n    <Button color=\"primary\" fullWidth onClick={() => setRequesting(false)}>搜索</Button>\r\n  </div>;\r\n}\r\n\r\nfunction UserFriends(props) {\r\n  const { onSelect } = props;\r\n  const [users, setUsers] = React.useState(null);\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  if (!requesting) {\r\n    setRequesting(true);\r\n    api.request('square/relations', \"GET\").then(resp => {\r\n      setRequesting(true);\r\n      setUsers(resp.data.relations.friends);\r\n    });\r\n  }\r\n  if (requesting && !users) {\r\n    return <>加载中……</>;\r\n  }\r\n  return <List>\r\n    {users && users.map((user, v) => <ListItem button onClick={() => {\r\n      onSelect && onSelect(user);\r\n    }}>\r\n      <ListItemText primary={getUidUser(user.uid) && user.uid}></ListItemText>\r\n    </ListItem>)}\r\n  </List>;\r\n}\r\n\r\nfunction BookInfoFrame(props) {\r\n  const { info } = props;\r\n  const convert_map = {\r\n    base_info: '基本信息',\r\n    description: '描述',\r\n    rating_nums: '评分'\r\n  };\r\n  const hidden_map = {\r\n    douban_id: 1,\r\n    created_at: 1,\r\n    douban_url: 1,\r\n    comment_number: 1,\r\n    pricing: 1,\r\n    updated_at: 1,\r\n    img_url: 1,\r\n    description: 1\r\n  };\r\n  return <div>\r\n    <Typography variant=\"h3\">{info.title}</Typography>\r\n    {Object.keys(info).map((k, v) => {\r\n      if (k == 'title') return null;\r\n      if (hidden_map[k]) return null;\r\n      return <Typography key={k} varian=\"body1\" color=\"textSecondary\">{convert_map[k] || k}: {info[k]}</Typography>\r\n    })}\r\n    <img src={info.img_url}></img>\r\n  </div>;\r\n}\r\n\r\nfunction BookDescFrame(props) {\r\n  const { info } = props;\r\n  const convert_map = {\r\n    base_info: '基本信息',\r\n    description: '描述',\r\n    rating_nums: '评分'\r\n  };\r\n  const selected_map = {\r\n    description: 1\r\n  };\r\n  return <div>\r\n    {Object.keys(info).map((k, v) => {\r\n      if (k == 'title') return null;\r\n      if (!selected_map[k]) return null;\r\n      return <div key={k}><Typography varian=\"body1\" color=\"textSecondary\">{convert_map[k] || k}: </Typography>\r\n        <Typography varian=\"body1\" color=\"textPrimary\">{info[k]}</Typography></div>;\r\n    })}\r\n    <img src={info.img_url}></img>\r\n  </div>;\r\n}\r\n\r\nfunction BookOperation(props) {\r\n  const { info } = props;\r\n  const [state, setInnerState] = React.useState({\r\n    openShare: false,\r\n    openAddList: false,\r\n    openRecommend: false\r\n  });\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  if (!info) return null;\r\n  const UserList = (props) => <>\r\n    <Typography varian=\"body2\" color=\"textSecondary\">搜索用户</Typography>\r\n    <UserSearch {...props}></UserSearch>\r\n    <Typography varian=\"body2\" color=\"textSecondary\">好友列表</Typography>\r\n    <UserFriends {...props}></UserFriends>\r\n  </>;\r\n  return <div>\r\n    <Grid container>\r\n      <Grid item xs={4}>\r\n        <IconButton onClick={() => setState({ openShare: true })}>\r\n          <ShareIcon></ShareIcon>\r\n        </IconButton>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">分享此书</Typography>\r\n      </Grid>\r\n      <Grid item xs={4}>\r\n        <IconButton onClick={async () => {\r\n          await api.request('square/book_list', \"POST\", {book_title: info.title, list_name: \"默认书单\"});\r\n          store.dispatch(setMessage(\"加入书单(默认书单)成功！\"));\r\n        }}>\r\n          <PlaylistAddIcon></PlaylistAddIcon>\r\n        </IconButton>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">加入书单</Typography>\r\n      </Grid>\r\n      <Grid item xs={4}>\r\n        <IconButton onClick={() => setState({ openShare: true })}>\r\n          <ContactMailIcon></ContactMailIcon>\r\n        </IconButton>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">推荐给…</Typography>\r\n      </Grid>\r\n    </Grid>\r\n    <Dialog open={state.openShare} onClose={() => setState({ openShare: false })}>\r\n      <DialogTitle>分享{info.title}给：</DialogTitle>\r\n      <DialogContent>\r\n        <UserList onSelect={async (user) => {\r\n          await api.request('square/messages', \"POST\", {to_uid: user.uid, content: `分享书籍：${info.title}`});\r\n          store.dispatch(setMessage(\"分享成功！\"));\r\n          setState({ openShare: false });\r\n        }}></UserList>\r\n      </DialogContent>\r\n    </Dialog>\r\n  </div>;\r\n}\r\n\r\nexport function CommentItem(props) {\r\n  const { info, comment } = props;\r\n  // const [user, setUser] = React.useState(getUidUser(comment && comment.uid));\r\n  const user = getUidUser(comment && comment.uid);\r\n  const [requested, setRequested] = React.useState(false);\r\n  // if (!comment || !info) return null;\r\n  if (!comment) return null;\r\n  // if (!requested && !user) {\r\n  //   setRequested(true);\r\n  //   api.request(`user/${comment.uid}`, \"GET\").then(resp => {\r\n  //     setUser(resp.data.user);\r\n  //     setRequested(true);\r\n  //   });\r\n  // }\r\n  if (!user && !requested) {\r\n    api.request(`user/${comment.uid}`, \"GET\").then(resp => {\r\n      updateUsers(resp.data.user);\r\n      setRequested(true);\r\n    });\r\n  }\r\n  const showInfo = <span>[{(user && user.username) || comment.uid}]{info ? \"\" : `在[${comment.book_title}]发表了评论`}: {parseTime(comment.updated_at)}</span>;\r\n  return <div>\r\n    <Typography varian=\"body1\" color=\"primary\">{showInfo}</Typography>\r\n    <Typography varian=\"body2\" color=\"textPrimary\" style={{ whiteSpace: 'pre-wrap' }}>{comment.content}</Typography>\r\n  </div>;\r\n}\r\n\r\nfunction BookCommentsAdd(props) {\r\n  const { info } = props;\r\n  const [input, setInput] = React.useState(\"\");\r\n  if (!info) return null;\r\n  return <>\r\n    <TextField multiline fullWidth variant=\"outlined\" value={input} onChange={e => {\r\n      setInput(e.target.value);\r\n    }}></TextField>\r\n    <Button fullWidth color=\"primary\" onClick={async () => {\r\n      api.request('square/comments', \"POST\", { book_title: info.title, content: input }).then(resp => {\r\n        \r\n      });\r\n    }}>发送书评</Button>\r\n  </>;\r\n}\r\n\r\nfunction BookComments(props) {\r\n  const { info, comments } = props;\r\n  if (!info || !comments || JSON.stringify(comments) === '{}') return null;\r\n  return <div>\r\n    {comments.map((comment, i) => {\r\n      return <div key={i}>\r\n        <CommentItem {...props} comment={comment}></CommentItem>\r\n      </div>;\r\n    })}\r\n  </div>;\r\n}\r\n\r\nexport default function BookInfo(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    title: null,\r\n    info: null,\r\n    comments: null,\r\n    recommends: null,\r\n    requestingInfo: false,\r\n    requestingComments: false,\r\n    requestingRecommends: false\r\n  });\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  const query = getHashedQuery();\r\n  // console.log(query);\r\n  if (state.title !== query[0][1]) {\r\n    setState({ title: query[0][1] });\r\n    return <Container>Loading...</Container>;\r\n  }\r\n  if (!state.requestingInfo) {\r\n    setState({ requestingInfo: true });\r\n    api.request('search', 'GET', { key: state.title, src: \"local_database\" }).then(resp => {\r\n      let info = null;\r\n      try {\r\n        info = resp.data.search.local_database.books[0];\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      if (!info) {\r\n        setState({ requestingInfo: true, info: false });\r\n      } else {\r\n        setState({ requestingInfo: true, info: info });\r\n      }\r\n    });\r\n  }\r\n  if (!state.requestingComments) {\r\n    setState({ requestingComments: true });\r\n    api.request('square/comments', 'GET', { book_title: state.title }).then(resp => {\r\n      let comments = null;\r\n      try {\r\n        comments = resp.data.comments;\r\n        // console.log('got comments', comments);\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n      if (!comments) {\r\n        setState({ requestingComments: true, comments: false });\r\n      } else {\r\n        setState({ requestingComments: true, comments: comments });\r\n      }\r\n    });\r\n  }\r\n  if (state.info === false) {\r\n    return <Container>\r\n      <Typography color=\"secondary\" variant=\"h5\">数据库扩展中……</Typography>\r\n      <Typography color=\"textSecondary\" variant=\"body2\">数据库扩展中……</Typography>\r\n    </Container>\r\n  }\r\n  const next_props = state;\r\n  return <>\r\n    <Grid container spacing={1}>\r\n      <Grid item lg={4} sm={6} xs={12}>\r\n        <div style={{ width: \"100%\", height: \"100%\", display: \"flex\", justifyContent: \"center\", flexDirection: \"column\", justifyItems: \"center\", alignItems: \"center\" }}>\r\n          <Paper style={{ width: \"100%\", height: \"100%\", maxHeight: 480, maxWidth: 360 }}>\r\n            <div style={{ width: \"100%\", height: \"100%\", display: \"flex\", justifyContent: \"center\", flexDirection: \"column\", justifyItems: \"center\", alignItems: \"center\" }}>\r\n              <Typography variant=\"body2\" color=\"textSecondary\">暂无封面</Typography>\r\n            </div>\r\n          </Paper>\r\n        </div>\r\n      </Grid>\r\n      <Grid item lg xs sm xs>\r\n        <BookInfoFrame {...next_props}></BookInfoFrame>\r\n        <BookDescFrame {...next_props}></BookDescFrame>\r\n        <BookOperation {...next_props}></BookOperation>\r\n      </Grid>\r\n    </Grid>\r\n    <Grid container spacing={1}>\r\n      {state.comments && <Grid item lg={4}>\r\n      </Grid>}\r\n      {state.comments && <Grid item lg={8}>\r\n        <Typography variant=\"h5\">查看书评</Typography>\r\n        <BookComments {...next_props}></BookComments>\r\n        <BookCommentsAdd {...next_props}></BookCommentsAdd>\r\n      </Grid>}\r\n    </Grid>\r\n  </>;\r\n}","import React from 'react';\r\nimport { TextField, Button, Container, Dialog, DialogContent, DialogTitle, LinearProgress, List, ListItem, Typography } from \"@material-ui/core\";\r\nimport { api } from '../api/api';\r\nimport { CommentItem } from \"./BookInfo\";\r\nimport store from \"../data/store\";\r\nimport { getUidUser, updateUsers } from \"../utils/utils\";\r\nimport { setMessage } from '../data/action';\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nfunction SendDynamic(props) {\r\n  const { onRefresh } = props;\r\n  const [content, setContent] = React.useState(\"\");\r\n  return <div>\r\n    <TextField multiline style={{ width: \"100%\" }} value={content} onChange={e => setContent(e.target.value)}></TextField>\r\n    <Button variant=\"contained\" onClick={async () => {\r\n      await api.request('square/dynamic', \"POST\", { dynamic: content });\r\n      onRefresh && onRefresh();\r\n    }}>发送新动态</Button>\r\n  </div>;\r\n}\r\n\r\nfunction ItemOperation(props) {\r\n  const { item, onClose } = props;\r\n  const [requested, setRequested] = React.useState(false);\r\n  const [visit, setVisit] = React.useState(null);\r\n  const self = store.getState().user;\r\n  if (!item) return null;\r\n\r\n  const user = getUidUser(item.uid);\r\n  if (!user && !requested) {\r\n    setRequested(true);\r\n    api.request(`user/${item.uid}`, \"GET\").then(resp => {\r\n      updateUsers(resp.data.user);\r\n      setRequested(true);\r\n    });\r\n    return null;\r\n  }\r\n\r\n  if (visit) return <Redirect to={visit}></Redirect>;\r\n\r\n  const listItems = <List>\r\n    <ListItem button onClick={() => {\r\n      setVisit(`/book_info?title=${item.book_title}`);\r\n      // onClose && onClose();\r\n    }}>\r\n      访问详情页\r\n    </ListItem>\r\n    <ListItem button onClick={() => {\r\n      store.dispatch(setMessage(\"点赞爆棚！感谢推荐（\"));\r\n      onClose && onClose();\r\n    }}>\r\n      点赞\r\n    </ListItem>\r\n    <ListItem button disabled={self.uid === item.uid} onClick={async () => {\r\n      await api.request('square/relations', \"POST\", {\r\n        to_uid: item.uid,\r\n        is_friends: true\r\n      });\r\n      store.dispatch(setMessage(\"成功\"));\r\n      onClose && onClose();\r\n    }}>\r\n      加为好友\r\n    </ListItem>\r\n    <ListItem button onClick={() => {\r\n      store.dispatch(setMessage(\"推荐好了（才怪\"));\r\n      onClose && onClose();\r\n    }}>\r\n      向他推荐书\r\n    </ListItem>\r\n    <ListItem button onClick={() => {\r\n      setVisit(`/me?message_to=${item.uid}`);\r\n    }}>\r\n      私信\r\n    </ListItem>\r\n  </List>;\r\n  if (item.action === \"comments\") {\r\n    return <Dialog onClose={onClose} open={!!item}>\r\n      <DialogTitle>{(user && (user.nick || user.username)) || item.uid} 在 {item.book_title} 发布的的评论</DialogTitle>\r\n      <DialogContent>\r\n        <Typography>{item.content}</Typography>\r\n        {listItems}\r\n      </DialogContent>\r\n    </Dialog>;\r\n  }\r\n  return null;\r\n}\r\n\r\nexport default function Square(props) {\r\n  const { child } = props;\r\n  const [square, setSquare] = React.useState(null);\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  const [itemNow, setItemNow] = React.useState(null);\r\n\r\n  const ignoreActions = {\r\n    messages: 1,\r\n    relations: 1,\r\n    book_list: 1\r\n  };\r\n  if (!requesting) {\r\n    setRequesting(true);\r\n    api.request('square', \"GET\").then(resp => {\r\n      if (!resp.data.all) return;\r\n      setSquare(resp.data.all);\r\n    });\r\n    return <LinearProgress color=\"primary\"></LinearProgress>;\r\n  }\r\n  return (<Container>\r\n    {!child && <Typography variant=\"h4\">\r\n      交流广场\r\n    </Typography>}\r\n    <List>\r\n      {square && square.map((item, v) => {\r\n        if (ignoreActions[item.action]) return null;\r\n        return <ListItem button key={item.created_at} onClick={() => setItemNow(item)}>{\r\n          (() => {\r\n            if (!item.action) return null;\r\n            if (item.action === 'comments') {\r\n              return <CommentItem comment={item}></CommentItem>;\r\n            }\r\n            return null;\r\n          })()\r\n        }</ListItem>;\r\n      })}\r\n    </List>\r\n    {!child && <SendDynamic></SendDynamic>}\r\n    <ItemOperation item={itemNow} onRefresh={() => { setRequesting(false); }} onClose={() => setItemNow(null)}></ItemOperation>\r\n  </Container>);\r\n};","import React from 'react';\r\nimport { Box, Button, Container, Divider, FormControl, Grid, InputLabel, MenuItem, Select, TextField, Typography } from \"@material-ui/core\";\r\nimport Recomends from \"../components/Recommends\";\r\nimport { api } from \"../api/api\";\r\nimport SearchBox from '../components/SearchBox';\r\nimport PopularAuthors from '../components/PopularAuthors';\r\nimport PopularTags from '../components/PopularTags';\r\nimport Slides from '../components/Slides';\r\nimport history from \"../utils/history\";\r\nimport { urlEncode } from '../utils/utils';\r\nimport { Redirect } from 'react-router-dom';\r\nimport Square from './Square';\r\nexport default function Dashboard(props) {\r\n  const [visit, setVisit] = React.useState(null);\r\n  if (visit) {\r\n    return <Redirect to={visit}></Redirect>;\r\n  }\r\n  return (<Container>\r\n    <Box>\r\n      <Box style={{ paddingLeft: 40, paddingRight: 40 }}>\r\n        <SearchBox onSearch={(key, src) => {\r\n          // history.push({ pathname: \"/search\", search: '?' + urlEncode({ key, src }).slice(1) });\r\n          setVisit(`/search?key=${key}&src=${src}`);\r\n          // history.push({ pathname: \"/search\", params: { key, src } });\r\n        }}></SearchBox>\r\n      </Box>\r\n    </Box>\r\n    {/* <br /> */}\r\n    {/* <Divider></Divider> */}\r\n    {/* <Slides></Slides> */}\r\n    {/* <br /> */}\r\n    {/* <Divider></Divider> */}\r\n    {/* <br /> */}\r\n    {/* <Grid container spacing={10}>\r\n      <Grid item lg={6} sm={12} style={{ padding: 20 }}>\r\n        <PopularAuthors></PopularAuthors>\r\n      </Grid>\r\n      <Grid item lg={6} sm={12} style={{ padding: 20 }}>\r\n        <PopularTags></PopularTags>\r\n      </Grid>\r\n    </Grid>\r\n    <br /> */}\r\n    {/* <Divider></Divider> */}\r\n    <br />\r\n    <Recomends></Recomends>\r\n    <br />\r\n    <Typography variant=\"h4\">\r\n      交流广场\r\n    </Typography>\r\n    <Square child></Square>\r\n  </Container>);\r\n};","import { Box, Button, Container, Divider, TextField, Typography, Zoom, Fade } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport { setMessage, setUser } from '../data/action';\r\nimport store from '../data/store';\r\nimport { objectUpdate } from '../utils/utils';\r\n\r\n\r\nfunction LoginFrame(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    username: \"\",\r\n    password: \"\",\r\n    captcha: \"\",\r\n    actionType: 'login'\r\n  });\r\n  const refUsername = React.useRef();\r\n  const refPassword = React.useRef();\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  // style={{ display: \"flex\", justifyContent: 'center', alignItems: \"center\", flexDirection: \"column\", }}\r\n  const actionLogin = state.actionType === 'login' ? true : false;\r\n  const handleAction = async () => {\r\n    // console.log('handle', actionLogin);\r\n    if (actionLogin) {\r\n      const res = await api.request('session', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code !== 200) return;\r\n      // 获取user\r\n      const user = await api.request('user', 'GET');\r\n      if (user.code !== 200) return;\r\n      console.log('user', user.data.user);\r\n      store.dispatch(setUser(user.data.user));\r\n    } else {\r\n      // 注册，注册成功则跳转登录\r\n      const res = await api.request('user', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code === 200) {\r\n        // 弹窗\r\n        store.dispatch(setMessage(\"注册成功\"));\r\n        setState({actionType: 'login'});\r\n      }\r\n    }\r\n  }\r\n\r\n  return (<Box>\r\n    <Typography variant=\"h4\">{actionLogin ? \"登录\" : \"注册\"}</Typography>\r\n    <br />\r\n    <Divider></Divider>\r\n    <br />\r\n    <TextField fullWidth ref={refUsername} label=\"用户名\" variant=\"outlined\" value={state.username} onChange={e => {\r\n      setState({ username: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        refPassword.current.querySelector(\"input\").focus();\r\n      }\r\n    }} />\r\n    <br /><br />\r\n    <TextField fullWidth ref={refPassword} label=\"密码\" variant=\"outlined\" value={state.password} type=\"password\" onChange={e => {\r\n      setState({ password: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        handleAction();\r\n      }\r\n    }} />\r\n    <Fade in={actionLogin} style={{ display: actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>登录</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={() => setState({ actionType: \"sign_in\" })}>注册</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n    <Fade in={!actionLogin} style={{ display: !actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>注册</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" onClick={() => setState({ actionType: 'login' })}>返回登录</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n  </Box >);\r\n}\r\n\r\nexport default function Login(props) {\r\n  return <Container maxWidth=\"sm\">\r\n    <LoginFrame></LoginFrame>\r\n  </Container>\r\n}","import { Box, Grid, List, ListItem, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport BookItem from \"./BookItem\";\r\n\r\nfunction SmartSearchResult(props) {\r\n  const { books } = props;\r\n  // console.log('books', books);\r\n  return <Grid container spacing={3}>\r\n    {books && books.map((book, k) => <Grid key={k} item xs={12} sm={6} lg={3}><BookItem book={{\r\n      title: book.title,\r\n      author: book.abstract,\r\n      desc: null,\r\n      cover: book.cover_url,\r\n      rating: book.rating\r\n    }}></BookItem></Grid>)}\r\n  </Grid>;\r\n}\r\n\r\nfunction DoubanResult(props) {\r\n  const { books } = props;\r\n  return <Grid container spacing={3}>\r\n    {books && books.map((book, k) => <Grid key={k} item xs={12} sm={6} lg={3}><BookItem book={{\r\n      title: book.title,\r\n      author: book.abstract,\r\n      desc: null,\r\n      cover: book.cover_url\r\n    }}></BookItem></Grid>)}\r\n  </Grid>;\r\n}\r\n\r\nexport function LocalDatabaseResult(props) {\r\n  const { books } = props;\r\n  console.log('local props', props);\r\n  return <Grid container spacing={3}>\r\n    {books && books.map((book, k) => <Grid key={k} item xs={12} sm={6} lg={3}><BookItem book={{\r\n      title: book.title,\r\n      author: book.base_info,\r\n      desc: book.description,\r\n      cover: null\r\n    }}></BookItem></Grid>)}\r\n  </Grid>;\r\n}\r\n\r\nexport default function SearchResult(props) {\r\n  const { result } = props;\r\n  return <List>\r\n    {result.smart_search ? <ListItem>\r\n      <Box>\r\n        <Typography variant=\"h4\">智能搜索</Typography>\r\n        <SmartSearchResult books={result.smart_search.books}></SmartSearchResult>\r\n      </Box>\r\n    </ListItem> : null}\r\n    {result.douban ? <ListItem>\r\n      <Box>\r\n        <Typography variant=\"h4\">豆瓣搜索</Typography>\r\n        <SmartSearchResult books={result.douban}></SmartSearchResult>\r\n      </Box>\r\n    </ListItem> : null}\r\n    {result.local_database ? <ListItem>\r\n      <Box>\r\n        <Typography variant=\"h4\">数据库搜索</Typography>\r\n        <LocalDatabaseResult books={result.local_database.books}></LocalDatabaseResult>\r\n      </Box>\r\n    </ListItem> : null}\r\n  </List>\r\n}","import { Container } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport { LocalDatabaseResult } from \"../components/SearchResult\";\r\nimport store from \"../data/store\";\r\nimport history from \"../utils/history\";\r\n\r\nexport default function Library(props) {\r\n  const [result, setResult] = React.useState(null);\r\n  const [requesting, setRequesting] = React.useState(false);\r\n\r\n  if (!requesting) {\r\n    setRequesting(true);\r\n    (async () => {\r\n      const resp = await api.request('search', 'GET', { key: \"\", src: \"local_database\" });\r\n      console.log(resp);\r\n      setRequesting(true);\r\n      setResult(resp.data);\r\n    })();\r\n  }\r\n  return <Container>\r\n    {result ? <LocalDatabaseResult books={result.search.local_database.books}></LocalDatabaseResult> : null}\r\n  </Container>\r\n}","import { Box, Container, Grid, List, ListItem, Paper, Typography } from \"@material-ui/core\";\r\nimport Avatar from \"@material-ui/core/Avatar\";\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport React from \"react\";\r\nimport { isChinese } from \"../utils/utils\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  small: {\r\n    width: theme.spacing(3),\r\n    height: theme.spacing(3),\r\n  },\r\n  large: {\r\n    width: theme.spacing(7),\r\n    height: theme.spacing(7),\r\n  },\r\n}));\r\n\r\nfunction People(props) {\r\n  const classes = useStyles();\r\n  const { username, nick, profile, head, link, readmeState } = props.people ? props.people : props;\r\n  let nickHead;\r\n  if (((!isChinese(nick[0])) && ((nick[1] && (!isChinese(nick[1]))) || (!nick[1]))) && !head) nickHead = nick.slice(0, 2);\r\n  const leftContent = <Box style={{ display: 'flex', flexDirection: \"column\", minWidth: 90 }} onClick={() => { link && window.open(link, '_blank'); }}>\r\n    <Box>\r\n      {head ? <Avatar alt={nick} src={head} className={classes.large}></Avatar> : <Avatar alt={nick} className={classes.large}>{nickHead ? nickHead : nick[0]}</Avatar>}\r\n    </Box>\r\n    <Box>\r\n      <Typography variant=\"h4\">{nick}</Typography>\r\n      {username ? <Typography variant=\"body1\">@{username}</Typography> : null}\r\n    </Box>\r\n  </Box>;\r\n  return <Box style={{ padding: 20, width: \"100%\" }}>\r\n    <Grid container spacing={3}>\r\n      <Grid item xs={9} lg={5}>\r\n        <Grid container spacing={3}>\r\n          <Grid item xs={4} lg={3}>\r\n            {leftContent}\r\n          </Grid>\r\n          <Grid item xs={5} lg={4} onClick={() => { window.open(link, '_blank'); }}>\r\n            {readmeState ? <Box>\r\n              <img src={readmeState}></img>\r\n            </Box> : null}\r\n          </Grid>\r\n        </Grid>\r\n      </Grid>\r\n      {profile ? <Grid item xs={12} lg={7}>\r\n        <Paper style={{ width: \"100%\" }}>\r\n          <Box style={{ backgroundColor: \"#00000020\", padding: 30, borderLeftStyle: \"solid\", borderLeftWidth: 10, borderLeftColor: \"#00000040\" }}>\r\n            <Typography variant=\"body1\">{profile}</Typography>\r\n          </Box>\r\n        </Paper>\r\n      </Grid> : null}\r\n    </Grid>\r\n  </Box >\r\n}\r\n\r\nexport default function About(props) {\r\n  const people = [\r\n    {\r\n      username: 'chiro2001',\r\n      nick: 'Chiro',\r\n      profile: \"I like it.\",\r\n      head: 'https://avatars.githubusercontent.com/u/41908064?v=4',\r\n      link: 'https://github.com/chiro2001',\r\n      readmeState: 'https://github-readme-stats.vercel.app/api?show_icons=false&username=chiro2001&count_private=true&include_all_commits=true&hide_border=true&hide_title=true&hide_rank=true&locale=cn'\r\n    },\r\n    {\r\n      username: 'criwits',\r\n      nick: 'Hans Wan',\r\n      profile: \"¯\\\\_(ツ)_/¯\",\r\n      head: 'https://avatars.githubusercontent.com/u/59825102?v=4',\r\n      link: 'https://github.com/criwits/',\r\n      readmeState: 'https://github-readme-stats.vercel.app/api?show_icons=false&username=criwits&count_private=true&include_all_commits=true&hide_border=true&hide_title=true&hide_rank=true&locale=cn'\r\n    },\r\n    {\r\n      username: 'lin-zhifan',\r\n      nick: 'Kiryu Sento',\r\n      head: 'https://portrait.gitee.com/uploads/avatars/user/2761/8283353_lin-zhifan_1620866347.png!avatar200',\r\n      link: 'https://gitee.com/lin-zhifan'\r\n    },\r\n    {\r\n      username: 'sealls',\r\n      nick: '海豹',\r\n      link: 'https://gitee.com/sealls',\r\n      head: \"http://bed-1254016670.cos.ap-guangzhou.myqcloud.com/my_imgs/kyMwmz_QQ%E5%9B%BE%E7%89%8720210519090319.jpg\"\r\n    },\r\n    {\r\n      nick: '魂莫千羽',\r\n      head: \"http://bed-1254016670.cos.ap-guangzhou.myqcloud.com/my_imgs/Rserrx_QQ%E5%9B%BE%E7%89%8720210519090319.jpg\"\r\n    },\r\n  ];\r\n  const ladderClimbers = {\r\n    username: 'Ladder-Climbers',\r\n    nick: 'Ladder Climbers',\r\n    profile: \"来自哈工深的项目开发小组~\",\r\n    head: 'https://avatars.githubusercontent.com/u/74187667?s=200&v=4',\r\n    link: 'https://gitee.com/ladder-climbers'\r\n  };\r\n  return <Container maxWidth=\"lg\">\r\n    <Typography variant=\"h4\">关于我们</Typography>\r\n    <People people={ladderClimbers}></People>\r\n    <Grid container>\r\n      {people.map((v, k) =>\r\n        <Grid key={k} item xs={v.readmeState ? 12 : 4}>\r\n          <People people={v}></People>\r\n        </Grid>\r\n      )}\r\n    </Grid>\r\n  </Container>\r\n}","import { Container } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nexport default function Help(props) {\r\n  return <Container>\r\n    Help\r\n  </Container>\r\n}","import { Container, Dialog, DialogContent, DialogTitle, List, ListItem, ListItemSecondaryAction, ListItemText, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nexport default function ListInfo(props) {\r\n  const { data, open, onClose, title, keyNames } = props;\r\n  const [openChild, setOpenChild] = React.useState(false);\r\n  const [child, setChild] = React.useState(null);\r\n  const [childTitle, setChildTitle] = React.useState(null);\r\n  // console.log(data);\r\n  // Object.keys(data).map((v, k) => { console.log(`v: ${v}, k: ${k}`) })\r\n\r\n  return <Dialog fullWidth open={open} onClose={onClose}>\r\n    <DialogTitle>{title}</DialogTitle>\r\n    <DialogContent>\r\n      <List style={{ width: \"100%\" }}>\r\n        {Object.keys(data).map((v, k) => {\r\n          const showName = keyNames ? (keyNames[v] || v) : (v);\r\n          if (!data[v]) return undefined;\r\n          if (typeof (data[v]) === 'object') {\r\n            return <ListItem key={k} button onClick={() => {\r\n              setChild(data[v]);\r\n              setChildTitle(showName);\r\n              setOpenChild(true);\r\n            }}>{showName}</ListItem>\r\n          } else {\r\n            const s = `${data[v]}`;\r\n            return <ListItem key={k}>\r\n              <ListItemText>{showName}</ListItemText>\r\n              <ListItemSecondaryAction>\r\n                <Typography variant=\"body1\">{s.slice(0, 20) + (s.length > 20 ? \"...\" : \"\")}</Typography>\r\n              </ListItemSecondaryAction>\r\n            </ListItem>\r\n          }\r\n        }\r\n        )}\r\n      </List>\r\n      {(child && childTitle) ? <ListInfo data={child} open={openChild} onClose={() => { setOpenChild(false); }} title={childTitle}></ListInfo> : undefined}\r\n    </DialogContent>\r\n  </Dialog>\r\n}","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport { Button, MenuItem, FormControl, InputLabel, List, ListItem, ListItemSecondaryAction, ListItemText, Select, ListSubheader, Switch, Dialog, DialogTitle, DialogContent, Typography, DialogActions } from \"@material-ui/core\";\r\nimport store from \"../data/store\";\r\nimport { setConfig, setErrorInfo, setMessage } from \"../data/action\";\r\nimport { funDownload } from \"../utils/utils\";\r\nimport ListInfo from \"../components/ListInfo\";\r\n\r\nfunction Settings(props) {\r\n  const [themeName, setThemeName] = React.useState(store.getState().config.data.theme_name);\r\n  const refConfigFileInput = React.useRef();\r\n  const [resetSettingsOpen, setResetSettingsOpen] = React.useState(false);\r\n  const [deleteDataOpen, setDeleteDataOpen] = React.useState(false);\r\n  const [openDaemon, setOpenDaemon] = React.useState(false);\r\n  const [openUser, setOpenUser] = React.useState(false);\r\n\r\n  const resetSettings = function () {\r\n    let c = store.getState().config;\r\n    c.data = c.data_default;\r\n    c.save();\r\n    c.load();\r\n    store.dispatch(setConfig(c));\r\n  }\r\n\r\n  const user = store.getState().user;\r\n\r\n  return (<Container maxWidth=\"md\">\r\n    <List>\r\n      <ListSubheader>用户账号</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"用户名\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          {user.username}\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenUser(true); }}>\r\n        <ListItemText primary=\"详细信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button>\r\n        <ListItemText primary=\"修改信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        let c = store.getState().config;\r\n        c.data = c.data_default;\r\n        c.save();\r\n        window.location.reload();\r\n      }}>\r\n        <ListItemText primary=\"退出登录\"></ListItemText>\r\n      </ListItem>\r\n      <ListSubheader>外观</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"主题设置\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <FormControl>\r\n            {/* <InputLabel></InputLabel> */}\r\n            <Select value={themeName} onChange={e => {\r\n              setThemeName(e.target.value);\r\n              let c = store.getState().config;\r\n              c.data.theme_name = e.target.value;\r\n              c.theme = c.theme_avaliable[c.data.theme_name];\r\n              c.save();\r\n              store.dispatch(setConfig(c));\r\n              setTimeout(() => { window.location.reload(); }, 200);\r\n            }}>\r\n              {store.getState().config.data.theme_avaliable.map((v, k) => <MenuItem key={k} value={v}>{v}</MenuItem>)}\r\n            </Select>\r\n          </FormControl>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem>\r\n        <ListItemText primary=\"设置数据同步\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <Switch defaultChecked={store.getState().config.data.settings_async} onChange={e => {\r\n            let c = store.getState().config;\r\n            c.data.settings_async = e.target.checked;\r\n            c.save();\r\n            store.dispatch(setConfig(c));\r\n          }}></Switch>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setResetSettingsOpen(true)}>\r\n        <ListItemText primary=\"回到默认设置\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setDeleteDataOpen(true)}>\r\n        <ListItemText primary=\"删除所有数据\"></ListItemText>\r\n      </ListItem>\r\n    </List>\r\n    <ListInfo data={store.getState().user} open={openUser} keyNames={{\r\n      username: '用户名', nick: '昵称', phone: '手机号', profile: '详细信息', state: '用户状态', created_at: '创建于', updated_at: '更新于'\r\n    }} title=\"用户信息\" onClose={() => { setOpenUser(false); }}></ListInfo>\r\n    <Dialog open={resetSettingsOpen} onClose={() => setResetSettingsOpen(false)}>\r\n      <DialogTitle>\r\n        回到默认设置\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除所有设置数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setResetSettingsOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={deleteDataOpen} onClose={() => setDeleteDataOpen(false)}>\r\n      <DialogTitle>\r\n        删除所有数据\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除软件数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setDeleteDataOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  </Container>)\r\n}\r\n\r\nexport default Settings;","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ListItem, ListItemText, ListItemIcon } from '@material-ui/core';\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\n\r\nfunction ListItemLink(props) {\r\n  const { icon, primary, to } = props;\r\n\r\n  const renderLink = React.useMemo(\r\n    () => React.forwardRef((itemProps, ref) => <RouterLink to={to} ref={ref} {...itemProps} />),\r\n    [to],\r\n  );\r\n\r\n  return (\r\n    <li>\r\n      <ListItem button component={renderLink}>\r\n        {icon ? <ListItemIcon>{icon}</ListItemIcon> : null}\r\n        <ListItemText primary={primary} />\r\n      </ListItem>\r\n    </li>\r\n  );\r\n}\r\n\r\nListItemLink.propTypes = {\r\n  icon: PropTypes.element,\r\n  primary: PropTypes.string.isRequired,\r\n  to: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default ListItemLink;\r\n\r\n","import { Container } from \"@material-ui/core\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport SearchBox from \"../components/SearchBox\";\r\nimport SearchResult from \"../components/SearchResult\";\r\nimport { setSearchInfo } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport history from \"../utils/history\";\r\nimport { getHashedQuery } from \"../utils/utils\";\r\n\r\nexport default function Search(props) {\r\n  const [result, setResult] = React.useState(null);\r\n  const [startedSearching, setStartedSearching] = React.useState(false);\r\n  const [defaultValue, setDefaultValue] = React.useState(null);\r\n  const query = getHashedQuery();\r\n  console.log('query', query);\r\n  const handleSearch = async (key, src, info) => {\r\n    console.log(key, src, info);\r\n    const resp = await api.request('search', 'GET', { key, src });\r\n    console.log(resp);\r\n    setResult(resp.data);\r\n  };\r\n  if (query.length === 2 && !startedSearching) {\r\n    handleSearch(query[0][1], query[1][1]);\r\n    setStartedSearching(true);\r\n    setDefaultValue({ key: query[0][1], src: query[1][1] });\r\n  }\r\n  return <Container>\r\n    <SearchBox defaultValue={defaultValue} onSearch={handleSearch}></SearchBox>\r\n    {result ? <SearchResult result={result.search}></SearchResult> : null}\r\n  </Container>\r\n}","import CryptoJS from \"crypto-js\";\r\nimport tencentConfig from \"../../secrets/tencent_cloud.json\";\r\n\r\n/** 获取签名 start */\r\n\r\nexport function toUint8Array(wordArray) {\r\n  // Shortcuts\r\n  const words = wordArray.words;\r\n  const sigBytes = wordArray.sigBytes;\r\n\r\n  // Convert\r\n  const u8 = new Uint8Array(sigBytes);\r\n  for (let i = 0; i < sigBytes; i++) {\r\n    u8[i] = (words[i >>> 2] >>> (24 - (i % 4) * 8)) & 0xff;\r\n  }\r\n  return u8;\r\n}\r\n\r\nexport function Uint8ArrayToString(fileData) {\r\n  let dataString = '';\r\n  for (let i = 0; i < fileData.length; i++) {\r\n    dataString += String.fromCharCode(fileData[i]);\r\n  }\r\n  return dataString;\r\n}\r\n// 签名函数示例\r\nexport function signCallback(signStr) {\r\n  const secretKey = tencentConfig.secretkey;\r\n  const hash = CryptoJS.HmacSHA1(signStr, secretKey);\r\n  const bytes = Uint8ArrayToString(toUint8Array(hash));\r\n  return window.btoa(bytes);\r\n}\r\n\r\n/** 获取签名 end */\r\n","function to16BitPCM(input) {\r\n  const dataLength = input.length * (16 / 8);\r\n  const dataBuffer = new ArrayBuffer(dataLength);\r\n  const dataView = new DataView(dataBuffer);\r\n  let offset = 0;\r\n  for (let i = 0; i < input.length; i++, offset += 2) {\r\n    const s = Math.max(-1, Math.min(1, input[i]));\r\n    dataView.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\r\n  }\r\n  return dataView;\r\n}\r\nfunction to16kHz(audioData) {\r\n  const data = new Float32Array(audioData);\r\n  const fitCount = Math.round(data.length * (16000 / 44100));\r\n  const newData = new Float32Array(fitCount);\r\n  const springFactor = (data.length - 1) / (fitCount - 1);\r\n  newData[0] = data[0];\r\n  for (let i = 1; i < fitCount - 1; i++) {\r\n    const tmp = i * springFactor;\r\n    const before = Math.floor(tmp).toFixed();\r\n    const after = Math.ceil(tmp).toFixed();\r\n    const atPoint = tmp - before;\r\n    newData[i] = data[before] + (data[after] - data[before]) * atPoint;\r\n  }\r\n  newData[fitCount - 1] = data[data.length - 1];\r\n  return newData;\r\n}\r\nexport default class WebRecorder {\r\n  constructor() {\r\n    if (!WebRecorder.instance) {\r\n      this.audioContext = null;\r\n      WebRecorder.instance = this;\r\n      this.stream = null;\r\n    }\r\n  }\r\n  start() {\r\n    if (this.audioContext) {\r\n      this.OnError('录音已开启');\r\n      return;\r\n    }\r\n    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia\r\n      || navigator.mozGetUserMedia || navigator.msGetUserMedia;\r\n\r\n    try {\r\n      this.audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\n      this.audioContext.resume();\r\n      if (!this.audioContext) {\r\n        this.OnError('浏览器不支持webAudioApi相关接口');\r\n        return;\r\n      }\r\n    } catch (e) {\r\n      if (!this.audioContext) {\r\n        this.OnError('浏览器不支持webAudioApi相关接口');\r\n        return;\r\n      }\r\n    }\r\n\r\n    // 获取用户的麦克风\r\n    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n      navigator.mediaDevices\r\n        .getUserMedia({\r\n          audio: true,\r\n          video: false,\r\n        })\r\n        .then(stream => {\r\n          getAudioSuccess(stream);\r\n        })\r\n        .catch(e => {\r\n          getAudioFail(e);\r\n        });\r\n    } else if (navigator.getUserMedia) {\r\n      navigator.getUserMedia(\r\n        {\r\n          audio: true,\r\n          video: false,\r\n        },\r\n        stream => {\r\n          getAudioSuccess(stream);\r\n        },\r\n        function (e) {\r\n          getAudioFail(e);\r\n        }\r\n      );\r\n    } else {\r\n      // Chiro: Add window.\r\n      if (navigator.userAgent.toLowerCase().match(/chrome/) && window.location.origin.indexOf('https://') < 0) {\r\n        this.OnError('chrome下获取浏览器录音功能，因为安全性问题，需要在localhost或127.0.0.1或https下才能获取权限');\r\n      } else {\r\n        this.OnError('无法获取浏览器录音功能，请升级浏览器或使用chrome');\r\n      }\r\n      this.audioContext && this.audioContext.close();\r\n      return;\r\n    }\r\n    const getAudioSuccess = (stream) => {\r\n      this.stream = stream;\r\n      // 将麦克风的声音输入这个对象\r\n      const mediaStreamSource = this.audioContext.createMediaStreamSource(stream); // 将声音对象输入这个对象\r\n      // 创建一个音频分析对象，采样的缓冲区大小为0（自动适配），输入和输出都是单声道\r\n      const scriptProcessor = this.audioContext.createScriptProcessor(0, 1, 1);\r\n      scriptProcessor.onaudioprocess = e => {\r\n        // 去处理音频数据\r\n        const inputData = e.inputBuffer.getChannelData(0);\r\n        const output = to16kHz(inputData);\r\n        const audioData = to16BitPCM(output);\r\n\r\n        this.OnReceivedData(audioData.buffer);\r\n      };\r\n\r\n      // 连接\r\n      mediaStreamSource.connect(scriptProcessor);\r\n      scriptProcessor.connect(this.audioContext.destination);\r\n    };\r\n    const getAudioFail = (err) => {\r\n      this.OnError(err);\r\n      this.stop();\r\n    };\r\n  }\r\n  stop() {\r\n    if (!(/Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent))) {\r\n      this.audioContext && this.audioContext.suspend();\r\n    }\r\n    this.audioContext && this.audioContext.suspend();\r\n    // 关闭通道\r\n    if (this.stream) {\r\n      // this.stream.getTracks()[0].stop();\r\n      this.stream.getTracks().map((val) => val.stop());\r\n      this.stream = null;\r\n    }\r\n  }\r\n  OnReceivedData(data) { // 获取音频数据\r\n\r\n  }\r\n  OnError(res) {\r\n    console.error(res)\r\n  }\r\n}\r\nwindow && (window.WebRecorder = WebRecorder);\r\n","// import '../cryptojs.js';\r\n\r\nexport class NewCredential {\r\n  constructor(query){\r\n    this.config = {\r\n      appid: query.appid,\r\n      secretid: query.secretid\r\n    };\r\n    this.query = query || null;\r\n  }\r\n\r\n  formatSignString(params){\r\n    let strParam = \"\";\r\n    let signStr = \"asr.cloud.tencent.com/asr/v2/\";\r\n    if(this.config['appid']){\r\n      signStr += this.config['appid'];\r\n    }\r\n    const keys = Object.keys(params);\r\n    keys.sort();\r\n    for (const k in keys) {\r\n      strParam += `&${keys[k]}=${params[keys[k]]}`;\r\n    }\r\n    return `${signStr}?${strParam.slice(1)}`;\r\n  }\r\n  async createQuery(){\r\n    const params = {};\r\n    const time = new Date().getTime();\r\n    const guid = () => {\r\n      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\r\n        const r = Math.random() * 16 | 0,\r\n          v = c === 'x' ? r : ((r & 0x3) | 0x8);\r\n        return v.toString(16);\r\n      });\r\n    };\r\n\r\n    async function getServerTime(){\r\n     return new Promise((resolve, reject)=>{\r\n        try {\r\n          const xhr = new XMLHttpRequest();\r\n          xhr.open(\"GET\", 'https://asr.cloud.tencent.com/server_time', true);\r\n          xhr.send();\r\n          xhr.onreadystatechange = function () {\r\n            if (xhr.readyState === 4 && xhr.status === 200) {\r\n              resolve(xhr.responseText);\r\n            }\r\n          }\r\n        } catch (error) {\r\n          reject(error);\r\n        }\r\n      })\r\n    }\r\n    const serverTime = await getServerTime();\r\n    params['secretid'] = this.config.secretid || '';\r\n    params['engine_model_type'] = this.query.engine_model_type || '16k_zh';\r\n    params['timestamp'] = parseInt(serverTime) || Math.round(time / 1000);\r\n    params['expired'] = Math.round(time / 1000) + 24 * 60 * 60;\r\n    params['nonce'] = Math.round(time / 100000);\r\n    params['voice_id'] = guid();\r\n\r\n    // 非必填参数\r\n    this.query.hasOwnProperty('voice_format') && (params['voice_format'] = this.query.voice_format);\r\n    this.query.hasOwnProperty('hotword_id') && (params['hotword_id'] = this.query.hotword_id);\r\n    this.query.hasOwnProperty('needvad') && (params['needvad'] = this.query.needvad);\r\n    this.query.hasOwnProperty('filter_dirty') && (params['filter_dirty'] = this.query.filter_dirty);\r\n    this.query.hasOwnProperty('filter_modal') && (params['filter_modal'] = this.query.filter_modal);\r\n    this.query.hasOwnProperty('filter_punc') && (params['filter_punc'] = this.query.filter_punc);\r\n    this.query.hasOwnProperty('convert_num_mode') && (params['convert_num_mode'] = this.query.convert_num_mode);\r\n    this.query.hasOwnProperty('word_info') && (params['word_info'] = this.query.word_info);\r\n    this.query.hasOwnProperty('vad_silence_time') && (params['vad_silence_time'] = this.query.vad_silence_time);\r\n\r\n    return params;\r\n  }\r\n  // 获取签名原文\r\n  async getSignStr() {\r\n    const queryStr = await this.createQuery();\r\n    return this.formatSignString(queryStr);\r\n  }\r\n}\r\n\r\nexport default class SpeechRecognizer {\r\n    constructor(params) {\r\n        this.appid = params.appid || ''\r\n        this.secretid = params.secretid || ''\r\n        this.socket = null;\r\n        this.isSignSuccess = false; // 是否鉴权成功\r\n        this.isSentenceBegin = false; // 是否一句话开始\r\n        this.query = {\r\n            ...params\r\n        };\r\n        // 用户鉴权函数\r\n        this.signCallback = params.signCallback || null;\r\n        this.isRecognizeComplete = false; // 当前是否识别结束\r\n    }\r\n    // 暂停识别，关闭连接\r\n    stop() {\r\n        if (this.socket && this.socket.readyState === 1) {\r\n          this.socket.send(JSON.stringify({type: 'end'}));\r\n        } else {\r\n          this.OnError('连接未建立或连接已关闭');\r\n          if (this.socket && this.socket.readyState === 1) {\r\n            this.socket.close();\r\n          } else {\r\n            this.OnError(\"Cannot close socket!\")\r\n          }\r\n        }\r\n    }\r\n    // 拼接鉴权数据\r\n    async getUrl() {\r\n        if (!this.appid || !this.secretid) {\r\n          this.OnError('请确认是否填入appid和secretid');\r\n          return false\r\n        }\r\n        const asr = new NewCredential(this.query);\r\n        const signStr = await asr.getSignStr();\r\n        return `${signStr}&signature=${encodeURIComponent(this.signCallback(signStr))}`;\r\n    }\r\n    // 建立websocket链接 data 为用户收集的音频数据\r\n    async start(){\r\n        const url = await this.getUrl();\r\n        if (!url) {\r\n          this.OnError('鉴权失败');\r\n          return\r\n        }\r\n        const self = this;\r\n        if ('WebSocket' in window) {\r\n          this.socket = new WebSocket(`wss://${url}`);\r\n        } else if ('MozWebSocket' in window) {\r\n          // Chiro: HERE UNDEFINED\r\n          this.socket = new window.MozWebSocket(`wss://${url}`);\r\n        } else {\r\n          this.OnError('浏览器不支持WebSocket')\r\n          return\r\n        }\r\n        this.socket.onopen = (e) => { // 连接建立时触发\r\n        };\r\n        this.socket.onmessage = (e) => { // 连接建立时触发\r\n          const response = JSON.parse(e.data);\r\n          if (response.code !== 0) {\r\n            this.OnError(response.message);\r\n            self.socket.close();\r\n            return;\r\n          } else {\r\n            if (!this.isSignSuccess) {\r\n              this.OnRecognitionStart(response);\r\n              this.isSignSuccess = true;\r\n            }\r\n            if (response.final === 1) {\r\n              this.isRecognizeComplete = true;\r\n              this.OnRecognitionComplete(response);\r\n              return;\r\n            }\r\n            if (response.result) {\r\n              const res = {\r\n                ...response.result,\r\n                voice_id: response.voice_id\r\n              }\r\n              if (response.result.slice_type === 0) {\r\n                this.OnSentenceBegin(res);\r\n                this.isSentenceBegin = true;\r\n              } else  if (response.result.slice_type === 2) {\r\n                if (!this.isSentenceBegin) {\r\n                  this.OnSentenceBegin(res);\r\n                }\r\n                this.OnSentenceEnd(res);\r\n              } else {\r\n                this.OnRecognitionResultChange(res);\r\n              }\r\n            }\r\n          }\r\n        };\r\n        this.socket.onerror = (e) => { // 通信发生错误时触发\r\n          this.socket.close();\r\n          this.OnError(e);\r\n        }\r\n        this.socket.onclose = (event) => {\r\n          if (!this.isRecognizeComplete) {\r\n            this.OnError(event);\r\n          }\r\n        }\r\n    }\r\n    // 发送数据\r\n    write(data) {\r\n      if (!this.socket || this.socket.readyState !== 1) {\r\n        this.OnError('连接未建立，请稍后发送数据！')\r\n        return\r\n      }\r\n      this.socket.send(data);\r\n    };\r\n    // 开始识别的时候\r\n    OnRecognitionStart(res) {\r\n\r\n    }\r\n    // 一句话开始的时候\r\n    OnSentenceBegin(res) {\r\n\r\n    }\r\n    // 识别结果发生变化的时候\r\n    OnRecognitionResultChange() {\r\n\r\n    }\r\n    // 一句话结束的时候\r\n    OnSentenceEnd() {\r\n\r\n    }\r\n    // 识别结束的时候\r\n    OnRecognitionComplete() {\r\n\r\n    }\r\n    // 识别失败\r\n    OnError() {\r\n\r\n    }\r\n}\r\nwindow && (window.SpeechRecognizer = SpeechRecognizer);\r\n","import WebRecorder from \"./WebRecorder.js\";\r\nimport SpeechRecognizer from \"./SpeechRecognizer.js\";\r\n// import '@babel/polyfill';\r\n\r\nexport default class WebAudioSpeechRecognizer {\r\n  constructor(params) {\r\n    this.params = params;\r\n    this.recorder = null;\r\n    this.speechRecognizer = null;\r\n    this.isCanSendData = false;\r\n  }\r\n  start() {\r\n    this.recorder = new WebRecorder();\r\n    this.recorder.OnReceivedData = (res) => {\r\n      if (this.isCanSendData) {\r\n        // 发送数据\r\n        this.speechRecognizer.write(res);\r\n      }\r\n    };\r\n    // 录音失败时\r\n    this.recorder.OnError = (err) => {\r\n      this.stop();\r\n      this.OnError(err);\r\n    }\r\n    this.recorder.start();\r\n    if (!this.speechRecognizer) {\r\n      this.speechRecognizer = new SpeechRecognizer(this.params);\r\n    }\r\n    // 开始识别\r\n    this.speechRecognizer.OnRecognitionStart = (res) => {\r\n      this.OnRecognitionStart(res);\r\n      this.isCanSendData = true;\r\n    };\r\n    // 一句话开始\r\n    this.speechRecognizer.OnSentenceBegin = (res) => {\r\n      this.OnSentenceBegin(res);\r\n    };\r\n    // 识别变化时\r\n    this.speechRecognizer.OnRecognitionResultChange = (res) => {\r\n      this.OnRecognitionResultChange(res);\r\n    };\r\n    // 一句话结束\r\n    this.speechRecognizer.OnSentenceEnd = (res) => {\r\n      this.OnSentenceEnd(res);\r\n    };\r\n    // 识别结束\r\n    this.speechRecognizer.OnRecognitionComplete = (res) => {\r\n      this.OnRecognitionComplete(res);\r\n      this.isCanSendData = false;\r\n    };\r\n    // 识别错误\r\n    this.speechRecognizer.OnError = (res) => {\r\n      this.OnError(res);\r\n      this.recorder.stop();\r\n      this.isCanSendData = false;\r\n    };\r\n    // 建立连接\r\n    this.speechRecognizer.start();\r\n  }\r\n  stop() {\r\n    if (this.recorder) {\r\n      this.recorder.stop();\r\n    }\r\n    if (this.speechRecognizer) {\r\n      this.speechRecognizer.stop();\r\n    }\r\n  }\r\n  // 开始识别的时候\r\n  OnRecognitionStart(res) {\r\n\r\n  }\r\n  // 一句话开始的时候\r\n  OnSentenceBegin(res) {\r\n\r\n  }\r\n  // 识别结果发生变化的时候\r\n  OnRecognitionResultChange() {\r\n\r\n  }\r\n  // 一句话结束的时候\r\n  OnSentenceEnd() {\r\n\r\n  }\r\n  // 识别结束的时候\r\n  OnRecognitionComplete() {\r\n\r\n  }\r\n  // 识别失败\r\n  OnError() {\r\n\r\n  }\r\n}\r\nwindow && (window.WebAudioSpeechRecognizer = WebAudioSpeechRecognizer);\r\n","import React from \"react\";\r\nimport store from \"../data/store\";\r\nimport { Container, Typography, List, ListItem, Dialog, DialogTitle, DialogContent, TextField, Button, LinearProgress, Divider } from \"@material-ui/core\";\r\nimport { getUidUser, parseHashedQuery, updateUsers } from \"../utils/utils\";\r\nimport { api } from \"../api/api\";\r\nimport { setMessage } from \"../data/action\";\r\n\r\nfunction UserBaseInfo(props) {\r\n  const { user } = props;\r\n  if (!user) return null;\r\n  return <div>\r\n    <Typography variant=\"h4\">{user.nick || user.username}</Typography>\r\n    <Typography variant=\"body2\">用户名: {user.username}</Typography>\r\n  </div>;\r\n}\r\n\r\nfunction SendMessage(props) {\r\n  const { to, onClose } = props;\r\n  const user = getUidUser(to);\r\n  const [content, setContent] = React.useState(\"\");\r\n  const [requested, setRequested] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  if (!to) return null;\r\n  if (!user && !requested) {\r\n    setRequested(true);\r\n    api.request(`user/${to}`, \"GET\").then(resp => {\r\n      updateUsers(resp.data.user);\r\n      forceUpdate();\r\n    });\r\n  }\r\n  return <Dialog open={!!to} onClose={onClose}>\r\n    <DialogTitle>向 {(user && user.username) || to} 发送私信</DialogTitle>\r\n    <DialogContent>\r\n      <UserBaseInfo user={user}></UserBaseInfo>\r\n      <TextField multiline fullWidth value={content} onChange={e => setContent(e.target.value)}></TextField>\r\n      <br /><br />\r\n      <Button fullWidth variant=\"contained\" color=\"primary\" onClick={async () => {\r\n        await api.request('square/messages', \"POST\", { to_uid: to, content });\r\n        store.dispatch(setMessage(\"发送成功！\"));\r\n        onClose && onClose();\r\n      }}>发送</Button>\r\n    </DialogContent>\r\n  </Dialog>;\r\n}\r\n\r\nfunction MyBookLists(props) {\r\n  const [requested, setRequested] = React.useState(false);\r\n  const [bookLists, setBookLists] = React.useState(null);\r\n  if (!requested) {\r\n    setRequested(true);\r\n    api.request('square/book_list', \"GET\").then(resp => {\r\n      setBookLists(resp.data.book_lists);\r\n    });\r\n  }\r\n  if (!bookLists) return <LinearProgress></LinearProgress>;\r\n  return <List>\r\n    {bookLists.map((bookList, v) => <ListItem button>\r\n      <Typography variant=\"body1\">{bookList.list_name}: </Typography>\r\n      <Typography variant=\"body2\">{bookList.book_title}</Typography>\r\n    </ListItem>)}\r\n  </List>;\r\n}\r\n\r\nexport default function Me(props) {\r\n  const user = store.getState().user;\r\n  const [receivedMessages, setReceivedMessages] = React.useState(null);\r\n  const [sentMessages, setSentMessages] = React.useState(null);\r\n  const [requestedMyMessages, setRequestedMyMessages] = React.useState(false);\r\n  const query = parseHashedQuery();\r\n  // console.log('query', query);\r\n  const [toUid, setToUid] = React.useState(query.message_to);\r\n  if (!requestedMyMessages) {\r\n    setRequestedMyMessages(true);\r\n    api.request('square/messages', \"GET\").then(resp => {\r\n      setReceivedMessages(resp.data.messages.received);\r\n      setSentMessages(resp.data.messages.sent);\r\n    });\r\n  }\r\n  const messagesList = receivedMessages && sentMessages && <List>\r\n    <ListItem>\r\n      <Typography variant=\"body2\" color=\"textSecondary\">发送的消息:</Typography>\r\n    </ListItem>\r\n    <Divider />\r\n    {sentMessages.map((message, v) => <ListItem button key={message.created_at}>\r\n      <Typography variant=\"h5\">{(getUidUser(message.to_uid) && getUidUser(message.to_uid).username) || message.to_uid}: </Typography>\r\n      <Typography variant=\"body1\">{message.content}</Typography>\r\n    </ListItem>)}\r\n    <ListItem>\r\n      <Typography variant=\"body2\" color=\"textSecondary\">接收到的消息:</Typography>\r\n    </ListItem>\r\n    <Divider />\r\n    {receivedMessages.map((message, v) => <ListItem button key={message.created_at}>\r\n      <Typography variant=\"h5\">{(getUidUser(message.uid) && getUidUser(message.uid).username) || message.uid}: </Typography>\r\n      <Typography variant=\"body1\">{message.content}</Typography>\r\n    </ListItem>)}\r\n  </List>;\r\n  return <>\r\n    {requestedMyMessages && !sentMessages ? <LinearProgress></LinearProgress> : null}\r\n    <List>\r\n      <ListItem>\r\n        <UserBaseInfo user={user}></UserBaseInfo>\r\n      </ListItem>\r\n      <ListItem>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">我的书单</Typography>\r\n      </ListItem>\r\n      <Divider></Divider>\r\n    </List>\r\n    <MyBookLists></MyBookLists>\r\n    {messagesList}\r\n    <SendMessage to={toUid} onClose={() => {\r\n      setRequestedMyMessages(false);\r\n      setToUid(null);\r\n    }}></SendMessage>\r\n  </>;\r\n}","import React from 'react';\r\nimport \"@fontsource/roboto\";\r\nimport clsx from 'clsx';\r\nimport Container from '@material-ui/core/Container';\r\nimport { makeStyles, useTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport List from '@material-ui/core/List';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport SearchIcon from '@material-ui/icons/Search';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport LibraryBooksIcon from '@material-ui/icons/LibraryBooks';\r\nimport LiveHelpIcon from '@material-ui/icons/LiveHelp';\r\nimport GroupIcon from '@material-ui/icons/Group';\r\nimport DynamicFeedIcon from '@material-ui/icons/DynamicFeed';\r\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\r\nimport ForumIcon from '@material-ui/icons/Forum';\r\nimport DashboardIcon from '@material-ui/icons/Dashboard';\r\nimport AlarmIcon from '@material-ui/icons/Alarm';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport StorageIcon from '@material-ui/icons/Storage';\r\nimport VerifiedUserIcon from '@material-ui/icons/VerifiedUser';\r\nimport PhonelinkIcon from '@material-ui/icons/Phonelink';\r\nimport {\r\n  HashRouter as Router,\r\n  // BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from \"react-router-dom\";\r\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\r\nimport { Provider } from 'react-redux'\r\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\r\nimport MomentUtils from '@date-io/moment';\r\nimport moment from 'moment';\r\nimport 'moment/locale/zh-cn';\r\nimport store from './data/store';\r\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogTitle, ListItem, Snackbar } from '@material-ui/core';\r\nimport { setConfig, setErrorInfo, setMessage, setReserveTableData, setRoomStockData, setShopInfo } from \"./data/action\";\r\n\r\nimport { isIterator, isMobileDevice, sleep } from \"./utils/utils\";\r\n\r\nimport Dashboard from './pages/Dashboard';\r\nimport Login from './pages/Login';\r\nimport Library from \"./pages/Library\";\r\nimport BookInfo from \"./pages/BookInfo\";\r\nimport Square from \"./pages/Square\";\r\nimport About from './pages/About';\r\nimport Help from './pages/Help';\r\nimport Settings from \"./pages/Settings\";\r\nimport { api } from './api/api';\r\nimport ListItemLink from './components/ListItemLink';\r\nimport Search from './pages/Search';\r\n// import record_tools from './utils/record_tools';\r\nimport tencentConfig from \"./secrets/tencent_cloud.json\";\r\nimport { signCallback } from \"./utils/asr/Authentication\";\r\nimport { Redirect } from 'react-router-dom';\r\n\r\nimport WebAudioSpeechRecognizer from './utils/asr/WebAudioSpeechRecognizer';\r\n// import L2d from './components/L2d';\r\nimport './css/waifu.css';\r\n\r\nimport MuiSwitch from '@material-ui/core/Switch';\r\nimport Me from './pages/Me';\r\n\r\nconst drawerWidth = 240;\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    // overflowX: 'auto',\r\n  },\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n  title: {\r\n    flexGrow: 1\r\n  },\r\n  appBarShift: {\r\n    marginLeft: drawerWidth,\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  menuButton: {\r\n    marginRight: 36,\r\n  },\r\n  hide: {\r\n    display: 'none',\r\n  },\r\n  drawer: {\r\n    width: drawerWidth,\r\n    flexShrink: 0,\r\n    whiteSpace: 'nowrap',\r\n  },\r\n  drawerOpen: {\r\n    width: drawerWidth,\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  drawerClose: {\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    overflowX: 'hidden',\r\n    width: theme.spacing(7) + 1,\r\n    [theme.breakpoints.up('sm')]: {\r\n      width: theme.spacing(9),\r\n    },\r\n  },\r\n  toolbar: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'flex-end',\r\n    padding: theme.spacing(0, 1),\r\n    // necessary for content to be below app bar\r\n    ...theme.mixins.toolbar,\r\n  },\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    width: '100%',\r\n    overflowX: 'auto',\r\n  },\r\n}));\r\n\r\nlet subscribers = {};\r\n\r\nlet last_data = {\r\n  config: null,\r\n  user: null,\r\n  daemon: null\r\n};\r\n\r\nstore.subscribe(async () => {\r\n  let state = store.getState();\r\n  // console.log('redux update to', state);\r\n  // 保存 config\r\n  if (state.config.data) {\r\n    if (JSON.stringify(state.config.data) != JSON.stringify(last_data.config)) {\r\n      console.log('Config will change:', state.config.data);\r\n      state.config.save();\r\n      if (store.getState().user && store.getState().config.data.settings_async) {\r\n        await api.request('sync', 'POST', { config: state.config.data });\r\n      }\r\n    } else {\r\n      // console.log('Not change:', state.config.data);\r\n    }\r\n    last_data.config = state.config.data;\r\n  }\r\n  for (let subFunc in subscribers) {\r\n    subscribers[subFunc](state);\r\n  }\r\n});\r\n\r\nlet recStarted = false;\r\nlet tbpStarted = false;\r\n\r\nconst setupRecorder = (rec, onSentenceEnd) => {\r\n  rec.OnRecognitionStart = (res) => {\r\n    console.log('开始识别', res);\r\n  };\r\n  // 一句话开始\r\n  rec.OnSentenceBegin = (res) => {\r\n    console.log('一句话开始', res);\r\n    recStarted = true;\r\n    window.startMessage(`你说: ……`, 10);\r\n  };\r\n  // 识别变化时\r\n  rec.OnRecognitionResultChange = (res) => {\r\n    if (!recStarted) {\r\n      return;\r\n    }\r\n    // console.log('识别变化时', res.voice_text_str, res);\r\n    window.updateMessage(`你说: ${res.voice_text_str}`);\r\n  };\r\n  // 一句话结束\r\n  rec.OnSentenceEnd = (res) => {\r\n    if (recStarted === false) {\r\n      console.warn(\"recStarted\", res);\r\n      return;\r\n    }\r\n    recStarted = false;\r\n    onSentenceEnd(res);\r\n  };\r\n  // 识别结束\r\n  rec.OnRecognitionComplete = (res) => {\r\n    console.log('识别结束', res);\r\n  };\r\n  // 识别错误\r\n  rec.OnError = (res) => {\r\n    console.log('识别失败', res)\r\n    // rec.start();\r\n  };\r\n}\r\n\r\nfunction App() {\r\n  const classes = useStyles();\r\n  const theme = useTheme();\r\n  const [open, setOpen] = React.useState(false);\r\n  const titleDefault = \"Mayne的大图书馆\";\r\n  const [errorDialogInfo, setErrorDialogInfo] = React.useState(false);\r\n  const [myMessage, setMyMessage] = React.useState(null);\r\n  const [title, setTitle] = React.useState(titleDefault);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  // const [recorder, setRecorder] = React.useState(null);\r\n  const [terminalId, setTerminalId] = React.useState(\"\");\r\n  const [visit, setVisit] = React.useState(null);\r\n  // 拉大到800会打开，拉小到600关闭\r\n  const triggerWidthOpen = 800;\r\n  const triggerWidthClose = 600;\r\n  // onMount & onUpdate\r\n  React.useEffect(() => {\r\n    const onWindowResize = () => {\r\n      let width = window.innerWidth;\r\n      // console.log(width);\r\n      if (!open && width >= triggerWidthOpen) setOpen(true);\r\n      if (open && width <= triggerWidthClose) setOpen(false);\r\n    };\r\n    window.addEventListener(\"load\", onWindowResize);\r\n    window.addEventListener('resize', onWindowResize);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"load\", onWindowResize);\r\n      window.removeEventListener(\"resize\", onWindowResize);\r\n    };\r\n  });\r\n\r\n  const assistantStart = store.getState().config.data.api_token.access_token ?\r\n    (store.getState().config.data.voice_assistant ? false : null) : null;\r\n  window.started = assistantStart;\r\n  const assistantEnable = assistantStart === false;\r\n  // console.log('window.started', window.started);\r\n\r\n  if (assistantEnable) {\r\n    const recParams = {\r\n      signCallback: signCallback, // 鉴权函数\r\n      // 用户参数\r\n      secretid: tencentConfig.secretid,\r\n      appid: tencentConfig.appid,\r\n      // 实时识别接口参数\r\n      engine_model_type: '16k_zh', // 因为内置WebRecorder采样16k的数据，所以参数 engineModelType 需要选择16k的引擎，为 '16k_zh'\r\n      // 以下为非必填参数，可跟据业务自行修改\r\n      voice_format: 1,\r\n      hotword_id: '08003a00000000000000000000000000',\r\n      needvad: 1,\r\n      filter_dirty: 1,\r\n      filter_modal: 2,\r\n      filter_punc: 0,\r\n      convert_num_mode: 1,\r\n      word_info: 2\r\n    }\r\n\r\n    // const globalRec = window.rec;\r\n\r\n    if (!window.rec) {\r\n      const rec = new WebAudioSpeechRecognizer(recParams);\r\n      window.rec = rec;\r\n      const onSentenseEnd = (res) => {\r\n        const text = res.voice_text_str;\r\n        console.log('一句话结束', res.voice_text_str, res);\r\n        window.hideMessage();\r\n        if (text.length === 0) {\r\n          window.startMessage(`能……再说一遍嘛？`, 10);\r\n          return;\r\n        }\r\n        if (tbpStarted) return;\r\n        tbpStarted = true;\r\n        // rec.speechRecognizer.stop();\r\n        // rec.stop();\r\n        // delete window.rec;\r\n        // window.rec = null;\r\n        if (!window.blocked) {\r\n          window.blocked = true;\r\n          const tid = localStorage.getItem(\"mayne_tbp_terminal\") || terminalId;\r\n          api.request('ai/tbp', \"POST\", { terminal_id: tid, text: text }).then(resp => {\r\n            const t = resp.data.tbp;\r\n            if ((t && !t.ResponseMessage.GroupList) || !t) {\r\n              window.startMessage(`能……再说一遍嘛？`, 10);\r\n            } else {\r\n              let textAll = '';\r\n              for (const r of t.ResponseMessage.GroupList)\r\n                textAll += r.Content;\r\n              api.request('ai/tts', \"GET\", { text: textAll }).then(resp2 => {\r\n                tbpStarted = false;\r\n                window.startMessage(`你说: ${text}\\n\\n${textAll}`, 10);\r\n                if (!resp2.data.tts) {\r\n                  return;\r\n                }\r\n                const tts = resp2.data.tts;\r\n                console.log(tts);\r\n                const audio = new Audio();\r\n                audio.autoplay = \"autoplay\";\r\n                audio.src = \"data:audio/wav;base64,\" + tts.Audio;\r\n                // rec.recorder.stop();\r\n                // rec.speechRecognizer.stop();\r\n                audio.oncanplaythrough = async () => {\r\n                  audio.play();\r\n                  // Length = (Size - 44) * 8 / (Rate * 1000 * Precision * Channerls)\r\n                  // len(s) = (size - 44) * 8 / (16 * 1000 * 32 * 2)\r\n                  const time_ms = ((window.atob(tts.Audio).length) * 4 - 44) * 8 / (16 * 1000 * 32 * 2) * 1000 + 1000;\r\n                  console.log('sleep for', time_ms, 'ms');\r\n                  await sleep(time_ms);\r\n                  window.blocked = false;\r\n                  // rec.recorder.start();\r\n                  // rec.speechRecognizer.start();\r\n                  // if (!window.rec) {\r\n                  //   const rec2 = new WebAudioSpeechRecognizer(recParams);\r\n                  //   window.rec = rec2;\r\n                  //   setupRecorder(rec2, onSentenseEnd);\r\n                  //   rec2.start();\r\n                  // }\r\n                  // setRecorder(rec2);\r\n\r\n                  // rec.start();\r\n                };\r\n              });\r\n              if (t.DialogStatus === \"COMPLETE\") {\r\n                let target = null;\r\n                for (const slot of t.SlotInfoList) {\r\n                  if (slot.SlotName === \"BookTitle\") {\r\n                    // setVisit(`/search?key=${slot.SlotValue}&src=smart_search`);\r\n                    target = slot.SlotValue;\r\n                    break;\r\n                    // window.location.href = `/#/search?key=${slot.SlotValue}&src=local_database`;\r\n\r\n                  }\r\n                }\r\n                if (target) {\r\n                  setTimeout(() => {\r\n                    window.location.href = `/#/search?key=${target}&src=local_database`;\r\n                  }, 2000);\r\n                }\r\n              }\r\n            }\r\n          });\r\n        }\r\n\r\n      };\r\n      setupRecorder(rec, onSentenseEnd);\r\n      // setRecorder(rec);\r\n      api.request('ai/tbp', \"GET\").then(resp => {\r\n        console.log('GET ai/tbp', resp);\r\n        // setRecorder(rec);\r\n        setTerminalId(resp.data.terminal_id);\r\n        localStorage.setItem(\"mayne_tbp_terminal\", resp.data.terminal_id);\r\n        rec.start();\r\n      });\r\n    }\r\n  }\r\n\r\n  // 注册一个当遇到错误的时候调用的钩子吧，用来显示错误信息\r\n  subscribers['Error'] = function (state) {\r\n    if (state.errorInfo) {\r\n      console.log('Error Hook: ', state.errorInfo);\r\n      setErrorDialogInfo(state.errorInfo);\r\n      // 清空错误信息\r\n      store.dispatch(setErrorInfo(null));\r\n    }\r\n  };\r\n  // 注册一个消息钩子\r\n  subscribers['Message'] = function (state) {\r\n    if (state.message) {\r\n      console.log('message: ', state.message);\r\n      setMyMessage(state.message);\r\n      store.dispatch(setMessage(null));\r\n    }\r\n  };\r\n  subscribers['User'] = function (state) {\r\n    if (state.user) {\r\n      if (JSON.stringify(state.user) != JSON.stringify(last_data.user)) {\r\n        console.log('Got user', state.user);\r\n        forceUpdate();\r\n      }\r\n      last_data.user = state.user;\r\n    }\r\n  };\r\n  subscribers['Daemon'] = function (state) {\r\n    if (state.daemon) {\r\n      if (JSON.stringify(state.daemon) != JSON.stringify(last_data.daemon)) {\r\n        forceUpdate();\r\n      }\r\n      last_data.daemon = state.daemon;\r\n    }\r\n  };\r\n\r\n  let routerContent = <Router>\r\n    <CssBaseline />\r\n    <AppBar\r\n      position=\"fixed\"\r\n      className={clsx(classes.appBar, {\r\n        [classes.appBarShift]: open,\r\n      })}\r\n    >\r\n      <Toolbar>\r\n        <IconButton\r\n          color=\"inherit\"\r\n          aria-label=\"open drawer\"\r\n          onClick={() => { setOpen(true); }}\r\n          edge=\"start\"\r\n          className={clsx(classes.menuButton, {\r\n            [classes.hide]: open,\r\n          })}\r\n        >\r\n          <MenuIcon />\r\n        </IconButton>\r\n        <Typography variant=\"h6\" noWrap className={classes.title}>\r\n          {title}\r\n        </Typography>\r\n        {/* <IconButton\r\n          color=\"inherit\"\r\n          aria-label=\"login\"\r\n          onClick={() => { }}\r\n        >\r\n          <AccountCircleIcon />\r\n        </IconButton> */}\r\n        <Typography variant=\"body2\">语音助手</Typography>\r\n        <MuiSwitch\r\n          checked={store.getState().config.data.voice_assistant}\r\n          onChange={e => {\r\n            let c = store.getState().config;\r\n            console.log(e);\r\n            c.data.voice_assistant = e.target.checked;\r\n            c.save();\r\n            window.location.reload();\r\n          }}></MuiSwitch>\r\n      </Toolbar>\r\n    </AppBar>\r\n    <Drawer\r\n      variant=\"permanent\"\r\n      className={clsx(classes.drawer, {\r\n        [classes.drawerOpen]: open,\r\n        [classes.drawerClose]: !open,\r\n      })}\r\n      classes={{\r\n        paper: clsx({\r\n          [classes.drawerOpen]: open,\r\n          [classes.drawerClose]: !open,\r\n        }),\r\n      }}\r\n    >\r\n      <div className={classes.toolbar}>\r\n        <IconButton onClick={() => { setOpen(false); }}>\r\n          {theme.direction === 'rtl' ? <ChevronLeftIcon /> : <ChevronLeftIcon />}\r\n        </IconButton>\r\n      </div>\r\n      <Divider />\r\n      <List onClick={() => {\r\n        if (window.innerWidth < 600) {\r\n          setOpen(false);\r\n        }\r\n      }}>\r\n        <ListItemLink to=\"/\" primary=\"启动页\" icon={<DashboardIcon />} />\r\n        <ListItemLink to=\"/search\" primary=\"找书\" icon={<SearchIcon />} />\r\n        <ListItemLink to=\"/library\" primary=\"馆藏\" icon={<LibraryBooksIcon />} />\r\n        <ListItemLink to=\"/square\" primary=\"广场\" icon={<DynamicFeedIcon />} />\r\n        <ListItemLink to=\"/me\" primary=\"我的\" icon={<ForumIcon />} />\r\n        <ListItemLink to=\"/settings\" primary=\"设置\" icon={<SettingsIcon />} />\r\n        <ListItemLink to=\"/help\" primary=\"帮助\" icon={<LiveHelpIcon />} />\r\n        <ListItemLink to=\"/about\" primary=\"关于\" icon={<GroupIcon />} />\r\n      </List>\r\n    </Drawer>\r\n    <main className={classes.content}>\r\n      <div className={classes.toolbar} />\r\n      <Switch>\r\n        <Route path={\"/\"} exact={true}>\r\n          <Dashboard></Dashboard>\r\n        </Route>\r\n        <Route path={\"/library\"} exact={true}>\r\n          <Library></Library>\r\n        </Route>\r\n        <Route path={\"/search\"} exact={true}>\r\n          <Search></Search>\r\n        </Route>\r\n        <Route path={\"/settings\"} exact={false}>\r\n          <Settings />\r\n        </Route>\r\n        <Route path={\"/square\"} exact={true}>\r\n          <Square></Square>\r\n        </Route>\r\n        <Route path={\"/me\"} exact={true}>\r\n          <Me></Me>\r\n        </Route>\r\n        <Route path={\"/help\"} exact={true}>\r\n          <Help></Help>\r\n        </Route>\r\n        <Route path={\"/about\"} exact={true}>\r\n          <About></About>\r\n        </Route>\r\n        <Route path={\"/book_info\"} exact={true}>\r\n          <BookInfo></BookInfo>\r\n        </Route>\r\n      </Switch>\r\n    </main>\r\n  </Router>;\r\n\r\n  if (!store.getState().user) {\r\n    if (store.getState().config.data.api_token.access_token) {\r\n      routerContent = <Typography variant=\"body1\">正在登录...</Typography>\r\n    } else {\r\n      routerContent = <Login></Login>\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <ThemeProvider theme={store.getState().config.theme}>\r\n        {routerContent}\r\n        <Dialog open={errorDialogInfo ? true : false} onClose={() => { setErrorDialogInfo(null); }}>\r\n          <DialogTitle>遇到错误</DialogTitle>\r\n          <DialogContent>\r\n            <Typography variant=\"body1\">错误信息</Typography>\r\n            <Box component=\"div\">\r\n              <Box component=\"div\">\r\n                {() => {\r\n                  if (isIterator(errorDialogInfo) && typeof (errorDialogInfo) !== 'string') {\r\n                    return <List>\r\n                      {errorDialogInfo.map((d, i) => <ListItem key={i}>\r\n                        <code>{JSON.stringify(d) === '{}' ? d.toString() : JSON.stringify(d)}</code>\r\n                      </ListItem>)}\r\n                    </List>;\r\n                  } else {\r\n                    return <code>{JSON.stringify(errorDialogInfo) === '{}' ? errorDialogInfo.toString() : JSON.stringify(errorDialogInfo)}</code>;\r\n                  }\r\n                }}\r\n              </Box>\r\n            </Box>\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button color=\"primary\" onClick={() => { window.location.reload() }}>刷新</Button>\r\n            <Button color=\"primary\" onClick={() => { setErrorDialogInfo(null); }}>取消</Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n        <Snackbar\r\n          anchorOrigin={{\r\n            vertical: 'bottom',\r\n            horizontal: 'right',\r\n          }}\r\n          onClose={() => setMyMessage(null)}\r\n          open={myMessage !== null}\r\n          autoHideDuration={4000}\r\n          message={myMessage}\r\n          action={\r\n            <React.Fragment>\r\n              <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={() => setMyMessage(null)}>\r\n                <CloseIcon fontSize=\"small\" />\r\n              </IconButton>\r\n            </React.Fragment>\r\n          }\r\n        />\r\n        {/* <button onClick={async () => {\r\n          console.log(\"terminal_id\", terminalId);\r\n          const resp = await api.request('ai/tbp', \"POST\", { terminal_id: terminalId, text: \"帮我找一本书\" });\r\n          console.log(resp);\r\n        }}>测试</button> */}\r\n      </ThemeProvider>\r\n      {/* <audio></audio> */}\r\n    </div>);\r\n}\r\n\r\nexport default App;\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport store from './data/store';\r\nimport { Provider } from 'react-redux';\r\nimport { api } from './api/api';\r\nimport { sleep } from './utils/utils';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport { setConfig, setErrorInfo, setUser } from './data/action';\r\n\r\n// 循环执行函数\r\nasync function cycleFunc(cycle = 1000) {\r\n  while (true) {\r\n    try {\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    await sleep(cycle);\r\n  }\r\n}\r\n\r\n// 开始执行的函数\r\nasync function startFunc() {\r\n  setTimeout(async () => {\r\n    const user = store.getState().user;\r\n    const isNowLogining = !user && store.getState().config.data.api_token.access_token;\r\n    if (isNowLogining) {\r\n      api.load_from_config();\r\n      const res = await api.request('user', 'GET');\r\n      // console.log('index res', res)\r\n      if (res.code === 200) {\r\n        // console.log('saving user', res.data.user)\r\n        store.dispatch(setUser(res.data.user));\r\n      }\r\n    }\r\n  }, 0);\r\n}\r\n\r\nReactDOM.render(\r\n  // <React.StrictMode>\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  // </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nstartFunc().then(() => {\r\n  cycleFunc();\r\n});\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}