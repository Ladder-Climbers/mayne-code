(this["webpackJsonpmayne-frontend"]=this["webpackJsonpmayne-frontend"]||[]).push([[0],{166:function(e,t){},191:function(e,t,n){},192:function(e,t,n){"use strict";n.r(t);var a=n(9),r=n.n(a),c=n(14),i=n(0),s=n.n(i),o=n(15),u=n.n(o),l=n(65),d=n(7),j=n(23),h=n(31),b=(n(156),n(4)),f=n(244),O=n(29),x=n(275),p=n(280),g=n(273),v=n(274),m=n(260),y=n(272),k=n(71),_=n(268),S=n(250),w=n(122),C=n.n(w),E=n(96),q=n.n(E),T=n(124),R=n.n(T),M=n(125),I=n.n(M),N=n(129),z=n.n(N),G=n(130),A=n.n(G),P=n(126),W=n.n(P),B=n(127),D=n.n(B),L=n(123),F=n.n(L),U=n(128),J=n.n(U),H=n(131),K=n.n(H),Q=n(44),V=n(19),X=n(93),Z=(n(160),n(46)),Y=n.n(Z),$=(n(106),n(70)),ee=n(111),te=n(33),ne=n(34),ae=n(132),re=n(241),ce=n(242),ie=n(243),se=n(85),oe={config:new(function(){function e(){Object(te.a)(this,e),this.ITEM_NAME="mayne_config",this.load=this.load.bind(this),this.save=this.save.bind(this),this.theme_avaliable={"\u9ed8\u8ba4\u4e3b\u9898":Object(ae.a)({palette:{primary:{main:re.a[500]},secondary:{main:ce.a[500]}}}),"\u9ed1\u6697\u6a21\u5f0f":Object(ae.a)({palette:{type:"dark",primary:{main:ie.a[500]},secondary:{main:se.a[500]}}})},this.data_default={debug:!1,version_frontend:.1,theme_name:"\u9ed8\u8ba4\u4e3b\u9898",theme_avaliable:["\u9ed8\u8ba4\u4e3b\u9898","\u9ed1\u6697\u6a21\u5f0f"],api_token:{},user:null,settings_async:!0,voice_assistant:!0},this.data=this.data_default,this.theme=this.theme_avaliable["\u9ed8\u8ba4\u4e3b\u9898"],this.load()}return Object(ne.a)(e,[{key:"load",value:function(){console.log("Config: loading config..."),this.data.debug&&(console.log("Config: load default config."),this.save());try{if(this.data=JSON.parse(localStorage.getItem(this.ITEM_NAME)),!this.data)throw new Error("Null data");if(console.log("Got data:",this.data),!this.data.version_frontend||this.data.version_frontend<this.data_default.version_frontend){for(var e in console.log("Config: update ".concat(this.data.version_frontend," -> ").concat(this.data_default.version_frontend)),this.data.version_frontend=this.data_default.version_frontend,this.data_default)this.data[e]||(console.log("    Config: add value ".concat(e)),this.data[e]=this.data_default[e]);this.save()}}catch(t){console.warn("Can not find ".concat(this.ITEM_NAME," in localStorage, use default config.")),this.data=this.data_default,this.save()}this.theme=this.theme_avaliable[this.data.theme_name],this.theme||(this.theme=this.theme_avaliable.default)}},{key:"save",value:function(){console.log("Config: saving config...");var e=JSON.stringify(this.data);return localStorage.setItem(this.ITEM_NAME,e),e}}]),e}()),tasks:[],user:null,users:{},daemon:null,errorInfo:null,message:null,searchInfo:null};var ue=Object($.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.config,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CONFIG":return t.data;default:return e}},errorInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.errorInfo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ERROR_INFO":return t.data;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.message,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.data;default:return e}},daemon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.daemon,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DAEMON":return t.data;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.user,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},users:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.users,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USERS":return t.data;default:return e}},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.tasks,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TASKS":return t.data;default:return e}},searchInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe.searchInfo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_SEARCH_INFO":return t.data;default:return e}}}),le=Object($.c)(ue,Object($.a)(ee.a)),de=n(265),je=n(266),he=n(267),be=n(276),fe=n(195),Oe=n(270),xe=n(262),pe=n(278);function ge(e){return function(t){t({type:"SET_CONFIG",data:e})}}function ve(e){return function(t){t({type:"SET_USER",data:e})}}function me(e){return function(t){t({type:"SET_ERROR_INFO",data:e})}}function ye(e){return function(t){t({type:"SET_MESSAGE",data:e})}}function ke(e){return function(t){t({type:"SET_SEARCH_INFO",data:e})}}var _e=n(134);function Se(e,t,n){if(null==e)return"";var a="",r=typeof e;if("string"===r||"number"===r||"boolean"===r)a+="&"+t+"="+(null==n||n?encodeURIComponent(e):e);else for(var c in e){var i=null==t?c:t+(e instanceof Array?"["+c+"]":"."+c);a+=Se(e[c],i,n)}return a}function we(){return Object(_e.a)(new URL("http://localhost"+window.location.hash.slice(1)).searchParams)}function Ce(e){return new Promise((function(t){setTimeout(t,e)}))}function Ee(e){return null!=e&&"function"===typeof e[Symbol.iterator]}function qe(e){if(Ee(e)&&"string"!==typeof e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}if("object"===typeof e){var a={};for(var r in e)a[r]=qe(e[r]);return a}return e}function Te(e,t){var n=qe(e);for(var a in t)n[a]=t[a];return n}function Re(e){return!/[^\u4E00-\u9FA5]/.test(e)}function Me(e){var t,n=le.getState().users;n[e.uid]=e,le.dispatch((t=n,function(e){e({type:"SET_USERS",data:t})}))}function Ie(e){return le.getState().users[e]}var Ne=n(252),ze=n(246),Ge=n(248),Ae=n(249),Pe=n(251),We=n(82),Be=n.n(We),De=n(117),Le=n.n(De),Fe=n(118),Ue=n.n(Fe),Je=n(115),He=(Object(Je.a)(),n(1)),Ke=Object(f.a)((function(e){return{root:{maxWidth:345},media:{paddingTop:"100%"},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"}}}));function Qe(e){var t=Ke(),n=e.book,a=s.a.useState(!1),r=Object(d.a)(a,2),c=r[0],i=r[1],o=s.a.useState(null),u=Object(d.a)(o,2),l=(u[0],u[1],s.a.useState(null)),j=Object(d.a)(l,2),f=j[0],O=j[1];return f?Object(He.jsx)(V.a,{to:f}):Object(He.jsxs)(ze.a,{className:t.root,children:[Object(He.jsx)(Ge.a,{className:t.media,image:n.cover?n.cover:"https://img2.doubanio.com/view/subject/m/public/s19120153.jpg",title:n.title,onClick:function(e){e.stopPropagation(),console.log("to visit title:",n.title),O("/book_info?title=".concat(n.title))}}),Object(He.jsxs)(Ae.a,{disableSpacing:!0,onClick:function(){i(!c)},children:[Object(He.jsxs)(be.a,{style:{float:"left"},children:[Object(He.jsx)(k.a,{variant:"h6",color:"textPrimary",component:"p",onClick:function(e){e.stopPropagation(),console.log("to visit title:",n.title)},children:n.title}),Object(He.jsx)(k.a,{variant:"h6",color:"textSecondary",component:"p",onClick:function(e){e.stopPropagation(),console.log("to visit author:",n.author)},children:n.author}),n.rating&&(0===n.rating.value?null:1)&&n.rating.value&&Object(He.jsxs)(k.a,{vatiant:"body2",color:"textSecondary",children:[n.rating.value,"\u5206"]})]}),Object(He.jsx)(S.a,{className:Object(b.a)(t.expand,Object(h.a)({},t.expandOpen,c)),onClick:function(){i(!c)},"aria-expanded":c,"aria-label":"show more",children:Object(He.jsx)(Le.a,{})})]}),Object(He.jsx)(Pe.a,{in:c,timeout:"auto",unmountOnExit:!0,children:Object(He.jsxs)(Ne.a,{children:[Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",component:"p",children:n.desc}),Object(He.jsx)(S.a,{children:Object(He.jsx)(Ue.a,{})}),Object(He.jsx)(S.a,{children:Object(He.jsx)(Be.a,{})})]})})]})}var Ve=n(253),Xe=n(254),Ze=n(255),Ye=new(function(){function e(){Object(te.a)(this,e),this.host=window.location.href.includes("localhost")?"localhost":null,this.port=443,this.api_version="v1",this.api_prefix="/api/".concat(this.api_version),this.protocol="https",this.url=this.host?"".concat(this.protocol,"://").concat(this.host,":").concat(this.port).concat(this.api_prefix):"".concat(this.api_prefix),this.access_token="",this.refresh_token=""}return Object(ne.a)(e,[{key:"set_token",value:function(e,t){void 0!==e&&(this.access_token=e),void 0!==t&&(this.refresh_token=t)}},{key:"get_token",value:function(){return{access_token:""===this.access_token?void 0:this.access_token,refresh_token:""===this.refresh_token?void 0:this.refresh_token}}},{key:"request_key",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",a=arguments.length>3?arguments[3]:void 0;return this.request("".concat(e,"/").concat(t),n,a)}},{key:"update_config",value:function(){var e=le.getState().config;e.data.api_token=this.get_token(),console.log("config.data.api_token",e.data.api_token),e.save(),le.dispatch(ge(e))}},{key:"load_from_config",value:function(){var e=le.getState().config;this.set_token(e.data.api_token.access_token,e.data.api_token.refresh_token)}},{key:"get_headers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={"Content-Type":"application/json"};return e&&(n.Refresh=this.refresh_token),t&&""!==this.access_token&&(n.Authorization=this.access_token),n}},{key:"request",value:function(){var e=Object(c.a)(r.a.mark((function e(t){var n,a,c,i,s,o,u,l,d,j,h,b,f=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:"GET",a=f.length>2?f[2]:void 0,c={method:n,mode:"cors",body:"GET"===n?void 0:a?JSON.stringify(a):void 0,headers:this.get_headers(Boolean("session"===t&&"DELETE"===n))},i="GET"===n&&a?"".concat(this.url,"/").concat(t,"?").concat(Se(a).slice(1)):"".concat(this.url,"/").concat(t),e.next=6,fetch(i,c);case 6:return s=e.sent,o=null,e.prev=8,e.next=11,s.json();case 11:o=e.sent,e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(8),console.error(e.t0),le.dispatch(me(e.t0)),e.abrupt("return",{code:s.status,error:s.statusText});case 19:if(console.log("raw js:",o),o||((o={}).message=s.statusText),void 0===o.code&&(o.code=s.status),422!==o.code){e.next=47;break}if(""!==this.refresh_token){e.next=25;break}return e.abrupt("return",null);case 25:return e.next=27,fetch("".concat(this.url,"/session"),{method:"GET",mode:"cors",headers:this.get_headers(!0)});case 27:return u=e.sent,e.prev=28,e.next=31,u.json();case 31:if(200!==(l=e.sent).code){e.next=39;break}this.set_token(l.data.access_token,l.data.refresh_token),this.update_config(),200===(d=this.request("user","GET")).code&&le.dispatch(ve(d.data.user)),e.next=41;break;case 39:return le.dispatch(me("\u767b\u5f55\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55")),e.abrupt("return",null);case 41:e.next=46;break;case 43:return e.prev=43,e.t1=e.catch(28),e.abrupt("return",{code:u.status,error:u.statusText});case 46:return e.abrupt("return",this.request(t,n,a));case 47:return 200===o.code?"session"===t&&"POST"===n?(j=o.data,h=j.access_token,b=j.refresh_token,this.set_token(h,b),this.update_config()):"session"===t&&"DELETE"===n&&(this.set_token("",""),this.update_config()):le.dispatch(me(o)),e.abrupt("return",o);case 49:case"end":return e.stop()}}),e,this,[[8,14],[28,43]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()),$e=Object(f.a)((function(e){return{root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",backgroundColor:e.palette.background.paper},gridList:{}}}));function et(){$e();var e=s.a.useState([]),t=Object(d.a)(e,2),n=t[0],a=t[1],r=s.a.useState(!1),c=Object(d.a)(r,2),i=c[0],o=c[1];i||(o(!0),Ye.request("douban_top").then((function(e){200!==e.code?me(e):(o(!0),a(e.data.douban_top))})));var u=Object(Ve.a)();return u&&console.log("Slide to bottom"),Object(He.jsxs)(be.a,{children:[Object(He.jsx)("br",{}),Object(He.jsx)(k.a,{variant:"h4",children:"\u597d\u4e66\u63a8\u8350"}),Object(He.jsx)("br",{}),Object(He.jsx)("div",{style:{maxHeight:320,overflow:"auto",width:"100%",overflowX:"hidden"},children:Object(He.jsx)(Xe.a,{container:!0,spacing:3,children:n.map((function(e,t){return Object(He.jsx)(Xe.a,{item:!0,xs:6,sm:4,lg:3,children:Object(He.jsx)(Qe,{book:e})},t)}))})}),Object(He.jsx)("br",{}),Object(He.jsx)(Ze.a,{color:"secondary",style:{display:u?"block":"none"}})]})}var tt=n(256),nt=n(281),at=n(277),rt=n(261),ct=n(283),it=n(259),st=n(263),ot=!1;function ut(e){var t=e.onSearch,n=e.defaultValue,a=le.getState().searchInfo,r=s.a.useState(n&&n.key?n.key:""),c=Object(d.a)(r,2),i=c[0],o=c[1],u=s.a.useState(a?n?n.src:Object.keys(a)[0]:null),l=Object(d.a)(u,2),j=l[0],h=l[1],b=s.a.useState(null),f=Object(d.a)(b,2),O=f[0],x=f[1],p=s.a.useState(!1),g=Object(d.a)(p,2),v=g[0],y=g[1],k=s.a.useState(null),_=Object(d.a)(k,2),S=_[0],w=_[1],C=function(){t&&(x(null),y(!1),t(i,j,a))};return v||(y(!0),Ye.request("search","PUT").then((function(e){x(e.data.search_logs)}))),Object(He.jsxs)(He.Fragment,{children:[Object(He.jsxs)(Xe.a,{container:!0,spacing:3,children:[Object(He.jsx)(Xe.a,{item:!0,xs:4,children:Object(He.jsxs)(tt.a,{fullWidth:!0,children:[Object(He.jsx)(nt.a,{children:"\u641c\u7d22\u7c7b\u578b"}),Object(He.jsx)(at.a,{value:j,onChange:function(e){h(e.target.value)},children:a?Object.keys(a).map((function(e,t){return Object(He.jsx)(rt.a,{value:e,children:a[e].name},t)})):Object(He.jsx)(rt.a,{children:"\u6b63\u5728\u52a0\u8f7d"})})]})}),Object(He.jsx)(Xe.a,{item:!0,xs:6,children:Object(He.jsx)(ct.a,{fullWidth:!0,onChange:function(e){return o(e.target.value)},onKeyDown:function(e){"Enter"===e.key&&C()},value:i,onFocus:function(e){w(e.currentTarget)},onBlur:function(){w(null)}})}),Object(He.jsx)(Xe.a,{item:!0,xs:2,children:Object(He.jsx)(xe.a,{variant:"contained",color:"primary",onClick:C,children:"\u641c\u7d22"})})]}),Object(He.jsx)(it.a,{style:{pointerEvents:"none"},disableAutoFocus:!0,disableEnforceFocus:!0,open:!!S,anchorEl:S,onClose:function(){w(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(He.jsxs)(m.a,{children:[O&&O.map((function(e,n){return Object(He.jsx)(fe.a,{button:!0,onClick:function(){t(e,j,a)},children:Object(He.jsx)(st.a,{primary:e.key})},e&&(e.created_at||e.key))})),(!O||O&&0===O.length)&&Object(He.jsx)(fe.a,{children:Object(He.jsx)(st.a,{primary:"\u65e0\u641c\u7d22\u8bb0\u5f55"})})]})})]})}le.getState().searchInfo||ot||Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ot=!0,e.next=3,Ye.request("search","PATCH");case 3:t=e.sent,le.dispatch(ke(t.data.search_info)),ot=!1;case 6:case"end":return e.stop()}}),e)})))();var lt=n(264);var dt=n(84),jt=n(135),ht=n(133),bt=n(86),ft=(Object(f.a)((function(e){return{root:{borderStyle:"dotted"}}})),s.a.Component,n(119)),Ot=n.n(ft),xt=n(120),pt=n.n(xt);function gt(e){var t=e.onSelect,n=s.a.useState(""),a=Object(d.a)(n,2),r=a[0],c=a[1],i=s.a.useState(null),o=Object(d.a)(i,2),u=o[0],l=o[1],j=s.a.useState(!1),h=Object(d.a)(j,2),b=h[0],f=h[1];return b||(f(!0),Ye.request("user_info","GET",{key:r}).then((function(e){f(!0),l(e.data.user_search)}))),Object(He.jsxs)("div",{children:[Object(He.jsx)(m.a,{children:u&&u.map((function(e,n){return Object(He.jsx)(fe.a,{button:!0,onClick:function(){t&&t(e)},children:Object(He.jsx)(st.a,{primary:e.username})},e.uid)}))}),Object(He.jsx)(ct.a,{value:r,fullWidth:!0,onChange:function(e){return c(e.target.value)},variant:"outlined"}),Object(He.jsx)(xe.a,{color:"primary",fullWidth:!0,onClick:function(){return f(!1)},children:"\u641c\u7d22"})]})}function vt(e){var t=e.onSelect,n=s.a.useState(null),a=Object(d.a)(n,2),r=a[0],c=a[1],i=s.a.useState(!1),o=Object(d.a)(i,2),u=o[0],l=o[1];return u||(l(!0),Ye.request("square/relations","GET").then((function(e){l(!0),c(e.data.relations.friends)}))),u&&!r?Object(He.jsx)(He.Fragment,{children:"\u52a0\u8f7d\u4e2d\u2026\u2026"}):Object(He.jsx)(m.a,{children:r&&r.map((function(e,n){return Object(He.jsx)(fe.a,{button:!0,onClick:function(){t&&t(e)},children:Object(He.jsx)(st.a,{primary:Ie(e.uid)&&e.uid})})}))})}function mt(e){var t=e.info,n={base_info:"\u57fa\u672c\u4fe1\u606f",description:"\u63cf\u8ff0",rating_nums:"\u8bc4\u5206"},a={douban_id:1,created_at:1,douban_url:1,comment_number:1,pricing:1,updated_at:1,img_url:1,description:1};return Object(He.jsxs)("div",{children:[Object(He.jsx)(k.a,{variant:"h3",children:t.title}),Object.keys(t).map((function(e,r){return"title"==e||a[e]?null:Object(He.jsxs)(k.a,{varian:"body1",color:"textSecondary",children:[n[e]||e,": ",t[e]]},e)})),Object(He.jsx)("img",{src:t.img_url})]})}function yt(e){var t=e.info,n={base_info:"\u57fa\u672c\u4fe1\u606f",description:"\u63cf\u8ff0",rating_nums:"\u8bc4\u5206"},a={description:1};return Object(He.jsxs)("div",{children:[Object.keys(t).map((function(e,r){return"title"==e?null:a[e]?Object(He.jsxs)("div",{children:[Object(He.jsxs)(k.a,{varian:"body1",color:"textSecondary",children:[n[e]||e,": "]}),Object(He.jsx)(k.a,{varian:"body1",color:"textPrimary",children:t[e]})]},e):null})),Object(He.jsx)("img",{src:t.img_url})]})}function kt(e){var t=e.info,n=s.a.useState({openShare:!1,openAddList:!1,openRecommend:!1}),a=Object(d.a)(n,2),i=a[0],o=a[1],u=function(e){return o(Te(i,e))};if(!t)return null;var l=function(e){return Object(He.jsxs)(He.Fragment,{children:[Object(He.jsx)(k.a,{varian:"body2",color:"textSecondary",children:"\u641c\u7d22\u7528\u6237"}),Object(He.jsx)(gt,Object(j.a)({},e)),Object(He.jsx)(k.a,{varian:"body2",color:"textSecondary",children:"\u597d\u53cb\u5217\u8868"}),Object(He.jsx)(vt,Object(j.a)({},e))]})};return Object(He.jsxs)("div",{children:[Object(He.jsxs)(Xe.a,{container:!0,children:[Object(He.jsxs)(Xe.a,{item:!0,xs:4,children:[Object(He.jsx)(S.a,{onClick:function(){return u({openShare:!0})},children:Object(He.jsx)(Be.a,{})}),Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u5206\u4eab\u6b64\u4e66"})]}),Object(He.jsxs)(Xe.a,{item:!0,xs:4,children:[Object(He.jsx)(S.a,{onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("square/book_list","POST",{book_title:t.title,list_name:"\u9ed8\u8ba4\u4e66\u5355"});case 2:le.dispatch(ye("\u52a0\u5165\u4e66\u5355(\u9ed8\u8ba4\u4e66\u5355)\u6210\u529f\uff01"));case 3:case"end":return e.stop()}}),e)}))),children:Object(He.jsx)(Ot.a,{})}),Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u52a0\u5165\u4e66\u5355"})]}),Object(He.jsxs)(Xe.a,{item:!0,xs:4,children:[Object(He.jsx)(S.a,{onClick:function(){return u({openShare:!0})},children:Object(He.jsx)(pt.a,{})}),Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u63a8\u8350\u7ed9\u2026"})]})]}),Object(He.jsxs)(de.a,{open:i.openShare,onClose:function(){return u({openShare:!1})},children:[Object(He.jsxs)(je.a,{children:["\u5206\u4eab",t.title,"\u7ed9\uff1a"]}),Object(He.jsx)(he.a,{children:Object(He.jsx)(l,{onSelect:function(){var e=Object(c.a)(r.a.mark((function e(n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("square/messages","POST",{to_uid:n.uid,content:"\u5206\u4eab\u4e66\u7c4d\uff1a".concat(t.title)});case 2:le.dispatch(ye("\u5206\u4eab\u6210\u529f\uff01")),u({openShare:!1});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})})]})]})}function _t(e){var t=e.info,n=e.comment,a=Ie(n&&n.uid),r=s.a.useState(!1),c=Object(d.a)(r,2),i=c[0],o=c[1];if(!n)return null;a||i||Ye.request("user/".concat(n.uid),"GET").then((function(e){Me(e.data.user),o(!0)}));var u,l=Object(He.jsxs)("span",{children:["[",a&&a.username||n.uid,"]",t?"":"\u5728[".concat(n.book_title,"]\u53d1\u8868\u4e86\u8bc4\u8bba"),": ",(u=n.updated_at,Y()(u).calendar())]});return Object(He.jsxs)("div",{children:[Object(He.jsx)(k.a,{varian:"body1",color:"primary",children:l}),Object(He.jsx)(k.a,{varian:"body2",color:"textPrimary",style:{whiteSpace:"pre-wrap"},children:n.content})]})}function St(e){var t=e.info,n=s.a.useState(""),a=Object(d.a)(n,2),i=a[0],o=a[1];return t?Object(He.jsxs)(He.Fragment,{children:[Object(He.jsx)(ct.a,{multiline:!0,fullWidth:!0,variant:"outlined",value:i,onChange:function(e){o(e.target.value)}}),Object(He.jsx)(xe.a,{fullWidth:!0,color:"primary",onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ye.request("square/comments","POST",{book_title:t.title,content:i}).then((function(e){}));case 1:case"end":return e.stop()}}),e)}))),children:"\u53d1\u9001\u4e66\u8bc4"})]}):null}function wt(e){var t=e.info,n=e.comments;return t&&n&&"{}"!==JSON.stringify(n)?Object(He.jsx)("div",{children:n.map((function(t,n){return Object(He.jsx)("div",{children:Object(He.jsx)(_t,Object(j.a)(Object(j.a)({},e),{},{comment:t}))},n)}))}):null}function Ct(e){var t,n=s.a.useState({title:null,info:null,comments:null,recommends:null,requestingInfo:!1,requestingComments:!1,requestingRecommends:!1}),a=Object(d.a)(n,2),r=a[0],c=a[1],i=function(e){return c(Te(r,e))},o=we();if(r.title!==o[0][1])return i({title:o[0][1]}),Object(He.jsx)(Ne.a,{children:"Loading..."});if(r.requestingInfo||(i({requestingInfo:!0}),Ye.request("search","GET",{key:r.title,src:"local_database"}).then((function(e){var t=null;try{t=e.data.search.local_database.books[0]}catch(n){console.error(n)}i(t?{requestingInfo:!0,info:t}:{requestingInfo:!0,info:!1})}))),r.requestingComments||(i({requestingComments:!0}),Ye.request("square/comments","GET",{book_title:r.title}).then((function(e){var t=null;try{t=e.data.comments}catch(n){console.error(n)}i(t?{requestingComments:!0,comments:t}:{requestingComments:!0,comments:!1})}))),!1===r.info)return Object(He.jsxs)(Ne.a,{children:[Object(He.jsx)(k.a,{color:"secondary",variant:"h5",children:"\u6570\u636e\u5e93\u6269\u5c55\u4e2d\u2026\u2026"}),Object(He.jsx)(k.a,{color:"textSecondary",variant:"body2",children:"\u6570\u636e\u5e93\u6269\u5c55\u4e2d\u2026\u2026"})]});var u=r;return Object(He.jsxs)(He.Fragment,{children:[Object(He.jsxs)(Xe.a,{container:!0,spacing:1,children:[Object(He.jsx)(Xe.a,{item:!0,lg:4,sm:6,xs:12,children:Object(He.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"column",justifyItems:"center",alignItems:"center"},children:Object(He.jsx)(bt.a,{style:{width:"100%",height:"100%",maxHeight:480,maxWidth:360},children:Object(He.jsx)("div",{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"column",justifyItems:"center",alignItems:"center"},children:Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u6682\u65e0\u5c01\u9762"})})})})}),Object(He.jsxs)(Xe.a,(t={item:!0,lg:!0,xs:!0,sm:!0},Object(h.a)(t,"xs",!0),Object(h.a)(t,"children",[Object(He.jsx)(mt,Object(j.a)({},u)),Object(He.jsx)(yt,Object(j.a)({},u)),Object(He.jsx)(kt,Object(j.a)({},u))]),t))]}),Object(He.jsxs)(Xe.a,{container:!0,spacing:1,children:[r.comments&&Object(He.jsx)(Xe.a,{item:!0,lg:4}),r.comments&&Object(He.jsxs)(Xe.a,{item:!0,lg:8,children:[Object(He.jsx)(k.a,{variant:"h5",children:"\u67e5\u770b\u4e66\u8bc4"}),Object(He.jsx)(wt,Object(j.a)({},u)),Object(He.jsx)(St,Object(j.a)({},u))]})]})]})}function Et(e){var t=e.onRefresh,n=s.a.useState(""),a=Object(d.a)(n,2),i=a[0],o=a[1];return Object(He.jsxs)("div",{children:[Object(He.jsx)(ct.a,{multiline:!0,style:{width:"100%"},value:i,onChange:function(e){return o(e.target.value)}}),Object(He.jsx)(xe.a,{variant:"contained",onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("square/dynamic","POST",{dynamic:i});case 2:t&&t();case 3:case"end":return e.stop()}}),e)}))),children:"\u53d1\u9001\u65b0\u52a8\u6001"})]})}function qt(e){var t=e.item,n=e.onClose,a=s.a.useState(!1),i=Object(d.a)(a,2),o=i[0],u=i[1],l=s.a.useState(null),j=Object(d.a)(l,2),h=j[0],b=j[1],f=le.getState().user;if(!t)return null;var O=Ie(t.uid);if(!O&&!o)return u(!0),Ye.request("user/".concat(t.uid),"GET").then((function(e){Me(e.data.user),u(!0)})),null;if(h)return Object(He.jsx)(V.a,{to:h});var x=Object(He.jsxs)(m.a,{children:[Object(He.jsx)(fe.a,{button:!0,onClick:function(){b("/book_info?title=".concat(t.book_title))},children:"\u8bbf\u95ee\u8be6\u60c5\u9875"}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){le.dispatch(ye("\u70b9\u8d5e\u7206\u68da\uff01\u611f\u8c22\u63a8\u8350\uff08")),n&&n()},children:"\u70b9\u8d5e"}),Object(He.jsx)(fe.a,{button:!0,disabled:f.uid===t.uid,onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("square/relations","POST",{to_uid:t.uid,is_friends:!0});case 2:le.dispatch(ye("\u6210\u529f")),n&&n();case 4:case"end":return e.stop()}}),e)}))),children:"\u52a0\u4e3a\u597d\u53cb"}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){le.dispatch(ye("\u63a8\u8350\u597d\u4e86\uff08\u624d\u602a")),n&&n()},children:"\u5411\u4ed6\u63a8\u8350\u4e66"}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){b("/me?message_to=".concat(t.uid))},children:"\u79c1\u4fe1"})]});return"comments"===t.action?Object(He.jsxs)(de.a,{onClose:n,open:!!t,children:[Object(He.jsxs)(je.a,{children:[O&&(O.nick||O.username)||t.uid," \u5728 ",t.book_title," \u53d1\u5e03\u7684\u7684\u8bc4\u8bba"]}),Object(He.jsxs)(he.a,{children:[Object(He.jsx)(k.a,{children:t.content}),x]})]}):null}function Tt(e){var t=e.child,n=s.a.useState(null),a=Object(d.a)(n,2),r=a[0],c=a[1],i=s.a.useState(!1),o=Object(d.a)(i,2),u=o[0],l=o[1],j=s.a.useState(null),h=Object(d.a)(j,2),b=h[0],f=h[1],O={messages:1,relations:1,book_list:1};return u?Object(He.jsxs)(Ne.a,{children:[!t&&Object(He.jsx)(k.a,{variant:"h4",children:"\u4ea4\u6d41\u5e7f\u573a"}),Object(He.jsx)(m.a,{children:r&&r.map((function(e,t){return O[e.action]?null:Object(He.jsx)(fe.a,{button:!0,onClick:function(){return f(e)},children:e.action&&"comments"===e.action?Object(He.jsx)(_t,{comment:e}):null},e.created_at)}))}),!t&&Object(He.jsx)(Et,{}),Object(He.jsx)(qt,{item:b,onRefresh:function(){l(!1)},onClose:function(){return f(null)}})]}):(l(!0),Ye.request("square","GET").then((function(e){e.data.all&&c(e.data.all)})),Object(He.jsx)(Ze.a,{color:"primary"}))}function Rt(e){var t=s.a.useState(null),n=Object(d.a)(t,2),a=n[0],r=n[1];return a?Object(He.jsx)(V.a,{to:a}):Object(He.jsxs)(Ne.a,{children:[Object(He.jsx)(be.a,{children:Object(He.jsx)(be.a,{style:{paddingLeft:40,paddingRight:40},children:Object(He.jsx)(ut,{onSearch:function(e,t){r("/search?key=".concat(e,"&src=").concat(t))}})})}),Object(He.jsx)("br",{}),Object(He.jsx)(et,{}),Object(He.jsx)("br",{}),Object(He.jsx)(k.a,{variant:"h4",children:"\u4ea4\u6d41\u5e7f\u573a"}),Object(He.jsx)(Tt,{child:!0})]})}var Mt=n(138);function It(e){var t=s.a.useState({username:"",password:"",captcha:"",actionType:"login"}),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useRef(),u=s.a.useRef(),l=function(e){return i(Te(a,e))},j="login"===a.actionType,h=function(){var e=Object(c.a)(r.a.mark((function e(){var t,n,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=16;break}return e.next=3,Ye.request("session","POST",{username:a.username,password:a.password});case 3:if(t=e.sent,console.log(t),200===t.code){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,Ye.request("user","GET");case 9:if(200===(n=e.sent).code){e.next=12;break}return e.abrupt("return");case 12:console.log("user",n.data.user),le.dispatch(ve(n.data.user)),e.next=21;break;case 16:return e.next=18,Ye.request("user","POST",{username:a.username,password:a.password});case 18:c=e.sent,console.log(c),200===c.code&&(le.dispatch(ye("\u6ce8\u518c\u6210\u529f")),l({actionType:"login"}));case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(He.jsxs)(be.a,{children:[Object(He.jsx)(k.a,{variant:"h4",children:j?"\u767b\u5f55":"\u6ce8\u518c"}),Object(He.jsx)("br",{}),Object(He.jsx)(_.a,{}),Object(He.jsx)("br",{}),Object(He.jsx)(ct.a,{fullWidth:!0,ref:o,label:"\u7528\u6237\u540d",variant:"outlined",value:a.username,onChange:function(e){l({username:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&u.current.querySelector("input").focus()}}),Object(He.jsx)("br",{}),Object(He.jsx)("br",{}),Object(He.jsx)(ct.a,{fullWidth:!0,ref:u,label:"\u5bc6\u7801",variant:"outlined",value:a.password,type:"password",onChange:function(e){l({password:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&h()}}),Object(He.jsx)(Mt.a,{in:j,style:{display:j?"block":"none"},timeout:{exit:0,enter:200},children:Object(He.jsxs)(be.a,{children:[Object(He.jsxs)(be.a,{children:[Object(He.jsx)("br",{}),Object(He.jsx)(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u767b\u5f55"})]}),Object(He.jsxs)(be.a,{children:[Object(He.jsx)("br",{}),Object(He.jsx)(xe.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){return l({actionType:"sign_in"})},children:"\u6ce8\u518c"})]})]})}),Object(He.jsx)(Mt.a,{in:!j,style:{display:j?"none":"block"},timeout:{exit:0,enter:200},children:Object(He.jsxs)(be.a,{children:[Object(He.jsxs)(be.a,{children:[Object(He.jsx)("br",{}),Object(He.jsx)(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u6ce8\u518c"})]}),Object(He.jsxs)(be.a,{children:[Object(He.jsx)("br",{}),Object(He.jsx)(xe.a,{fullWidth:!0,variant:"contained",onClick:function(){return l({actionType:"login"})},children:"\u8fd4\u56de\u767b\u5f55"})]})]})})]})}function Nt(e){return Object(He.jsx)(Ne.a,{maxWidth:"sm",children:Object(He.jsx)(It,{})})}function zt(e){var t=e.books;return Object(He.jsx)(Xe.a,{container:!0,spacing:3,children:t&&t.map((function(e,t){return Object(He.jsx)(Xe.a,{item:!0,xs:12,sm:6,lg:3,children:Object(He.jsx)(Qe,{book:{title:e.title,author:e.abstract,desc:null,cover:e.cover_url,rating:e.rating}})},t)}))})}function Gt(e){var t=e.books;return console.log("local props",e),Object(He.jsx)(Xe.a,{container:!0,spacing:3,children:t&&t.map((function(e,t){return Object(He.jsx)(Xe.a,{item:!0,xs:12,sm:6,lg:3,children:Object(He.jsx)(Qe,{book:{title:e.title,author:e.base_info,desc:e.description,cover:null}})},t)}))})}function At(e){var t=e.result;return Object(He.jsxs)(m.a,{children:[t.smart_search?Object(He.jsx)(fe.a,{children:Object(He.jsxs)(be.a,{children:[Object(He.jsx)(k.a,{variant:"h4",children:"\u667a\u80fd\u641c\u7d22"}),Object(He.jsx)(zt,{books:t.smart_search.books})]})}):null,t.douban?Object(He.jsx)(fe.a,{children:Object(He.jsxs)(be.a,{children:[Object(He.jsx)(k.a,{variant:"h4",children:"\u8c46\u74e3\u641c\u7d22"}),Object(He.jsx)(zt,{books:t.douban})]})}):null,t.local_database?Object(He.jsx)(fe.a,{children:Object(He.jsxs)(be.a,{children:[Object(He.jsx)(k.a,{variant:"h4",children:"\u6570\u636e\u5e93\u641c\u7d22"}),Object(He.jsx)(Gt,{books:t.local_database.books})]})}):null]})}function Pt(e){var t=s.a.useState(null),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useState(!1),u=Object(d.a)(o,2),l=u[0],j=u[1];return l||(j(!0),Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("search","GET",{key:"",src:"local_database"});case 2:t=e.sent,console.log(t),j(!0),i(t.data);case 6:case"end":return e.stop()}}),e)})))()),Object(He.jsx)(Ne.a,{children:a?Object(He.jsx)(Gt,{books:a.search.local_database.books}):null})}var Wt=n(284),Bt=Object(f.a)((function(e){return{small:{width:e.spacing(3),height:e.spacing(3)},large:{width:e.spacing(7),height:e.spacing(7)}}}));function Dt(e){var t,n=Bt(),a=e.people?e.people:e,r=a.username,c=a.nick,i=a.profile,s=a.head,o=a.link,u=a.readmeState;Re(c[0])||(!c[1]||Re(c[1]))&&c[1]||s||(t=c.slice(0,2));var l=Object(He.jsxs)(be.a,{style:{display:"flex",flexDirection:"column",minWidth:90},onClick:function(){o&&window.open(o,"_blank")},children:[Object(He.jsx)(be.a,{children:s?Object(He.jsx)(Wt.a,{alt:c,src:s,className:n.large}):Object(He.jsx)(Wt.a,{alt:c,className:n.large,children:t||c[0]})}),Object(He.jsxs)(be.a,{children:[Object(He.jsx)(k.a,{variant:"h4",children:c}),r?Object(He.jsxs)(k.a,{variant:"body1",children:["@",r]}):null]})]});return Object(He.jsx)(be.a,{style:{padding:20,width:"100%"},children:Object(He.jsxs)(Xe.a,{container:!0,spacing:3,children:[Object(He.jsx)(Xe.a,{item:!0,xs:9,lg:5,children:Object(He.jsxs)(Xe.a,{container:!0,spacing:3,children:[Object(He.jsx)(Xe.a,{item:!0,xs:4,lg:3,children:l}),Object(He.jsx)(Xe.a,{item:!0,xs:5,lg:4,onClick:function(){window.open(o,"_blank")},children:u?Object(He.jsx)(be.a,{children:Object(He.jsx)("img",{src:u})}):null})]})}),i?Object(He.jsx)(Xe.a,{item:!0,xs:12,lg:7,children:Object(He.jsx)(bt.a,{style:{width:"100%"},children:Object(He.jsx)(be.a,{style:{backgroundColor:"#00000020",padding:30,borderLeftStyle:"solid",borderLeftWidth:10,borderLeftColor:"#00000040"},children:Object(He.jsx)(k.a,{variant:"body1",children:i})})})}):null]})})}function Lt(e){return Object(He.jsxs)(Ne.a,{maxWidth:"lg",children:[Object(He.jsx)(k.a,{variant:"h4",children:"\u5173\u4e8e\u6211\u4eec"}),Object(He.jsx)(Dt,{people:{username:"Ladder-Climbers",nick:"Ladder Climbers",profile:"\u6765\u81ea\u54c8\u5de5\u6df1\u7684\u9879\u76ee\u5f00\u53d1\u5c0f\u7ec4~",head:"https://avatars.githubusercontent.com/u/74187667?s=200&v=4",link:"https://gitee.com/ladder-climbers"}}),Object(He.jsx)(Xe.a,{container:!0,children:[{username:"chiro2001",nick:"Chiro",profile:"I like it.",head:"https://avatars.githubusercontent.com/u/41908064?v=4",link:"https://github.com/chiro2001",readmeState:"https://github-readme-stats.vercel.app/api?show_icons=false&username=chiro2001&count_private=true&include_all_commits=true&hide_border=true&hide_title=true&hide_rank=true&locale=cn"},{username:"criwits",nick:"Hans Wan",profile:"\xaf\\_(\u30c4)_/\xaf",head:"https://avatars.githubusercontent.com/u/59825102?v=4",link:"https://github.com/criwits/",readmeState:"https://github-readme-stats.vercel.app/api?show_icons=false&username=criwits&count_private=true&include_all_commits=true&hide_border=true&hide_title=true&hide_rank=true&locale=cn"},{username:"lin-zhifan",nick:"Kiryu Sento",head:"https://portrait.gitee.com/uploads/avatars/user/2761/8283353_lin-zhifan_1620866347.png!avatar200",link:"https://gitee.com/lin-zhifan"},{username:"sealls",nick:"\u6d77\u8c79",link:"https://gitee.com/sealls",head:"http://bed-1254016670.cos.ap-guangzhou.myqcloud.com/my_imgs/kyMwmz_QQ%E5%9B%BE%E7%89%8720210519090319.jpg"},{nick:"\u9b42\u83ab\u5343\u7fbd",head:"http://bed-1254016670.cos.ap-guangzhou.myqcloud.com/my_imgs/Rserrx_QQ%E5%9B%BE%E7%89%8720210519090319.jpg"}].map((function(e,t){return Object(He.jsx)(Xe.a,{item:!0,xs:e.readmeState?12:4,children:Object(He.jsx)(Dt,{people:e})},t)}))})]})}function Ft(e){return Object(He.jsx)(Ne.a,{children:"Help"})}var Ut=n(269),Jt=n(279);function Ht(e){var t=e.data,n=e.open,a=e.onClose,r=e.title,c=e.keyNames,i=s.a.useState(!1),o=Object(d.a)(i,2),u=o[0],l=o[1],j=s.a.useState(null),h=Object(d.a)(j,2),b=h[0],f=h[1],O=s.a.useState(null),x=Object(d.a)(O,2),p=x[0],g=x[1];return Object(He.jsxs)(de.a,{fullWidth:!0,open:n,onClose:a,children:[Object(He.jsx)(je.a,{children:r}),Object(He.jsxs)(he.a,{children:[Object(He.jsx)(m.a,{style:{width:"100%"},children:Object.keys(t).map((function(e,n){var a=c&&c[e]||e;if(t[e]){if("object"===typeof t[e])return Object(He.jsx)(fe.a,{button:!0,onClick:function(){f(t[e]),g(a),l(!0)},children:a},n);var r="".concat(t[e]);return Object(He.jsxs)(fe.a,{children:[Object(He.jsx)(st.a,{children:a}),Object(He.jsx)(Ut.a,{children:Object(He.jsx)(k.a,{variant:"body1",children:r.slice(0,20)+(r.length>20?"...":"")})})]},n)}}))}),b&&p?Object(He.jsx)(Ht,{data:b,open:u,onClose:function(){l(!1)},title:p}):void 0]})]})}var Kt=function(e){var t=s.a.useState(le.getState().config.data.theme_name),n=Object(d.a)(t,2),a=n[0],r=n[1],c=(s.a.useRef(),s.a.useState(!1)),i=Object(d.a)(c,2),o=i[0],u=i[1],l=s.a.useState(!1),j=Object(d.a)(l,2),h=j[0],b=j[1],f=s.a.useState(!1),O=Object(d.a)(f,2),x=(O[0],O[1],s.a.useState(!1)),p=Object(d.a)(x,2),g=p[0],v=p[1],y=function(){var e=le.getState().config;e.data=e.data_default,e.save(),e.load(),le.dispatch(ge(e))},_=le.getState().user;return Object(He.jsxs)(Ne.a,{maxWidth:"md",children:[Object(He.jsxs)(m.a,{children:[Object(He.jsx)(lt.a,{children:"\u7528\u6237\u8d26\u53f7"}),Object(He.jsxs)(fe.a,{children:[Object(He.jsx)(st.a,{primary:"\u7528\u6237\u540d"}),Object(He.jsx)(Ut.a,{children:_.username})]}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){v(!0)},children:Object(He.jsx)(st.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(He.jsx)(fe.a,{button:!0,children:Object(He.jsx)(st.a,{primary:"\u4fee\u6539\u4fe1\u606f"})}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){var e=le.getState().config;e.data=e.data_default,e.save(),window.location.reload()},children:Object(He.jsx)(st.a,{primary:"\u9000\u51fa\u767b\u5f55"})}),Object(He.jsx)(lt.a,{children:"\u5916\u89c2"}),Object(He.jsxs)(fe.a,{children:[Object(He.jsx)(st.a,{primary:"\u4e3b\u9898\u8bbe\u7f6e"}),Object(He.jsx)(Ut.a,{children:Object(He.jsx)(tt.a,{children:Object(He.jsx)(at.a,{value:a,onChange:function(e){r(e.target.value);var t=le.getState().config;t.data.theme_name=e.target.value,t.theme=t.theme_avaliable[t.data.theme_name],t.save(),le.dispatch(ge(t)),setTimeout((function(){window.location.reload()}),200)},children:le.getState().config.data.theme_avaliable.map((function(e,t){return Object(He.jsx)(rt.a,{value:e,children:e},t)}))})})})]}),Object(He.jsxs)(fe.a,{children:[Object(He.jsx)(st.a,{primary:"\u8bbe\u7f6e\u6570\u636e\u540c\u6b65"}),Object(He.jsx)(Ut.a,{children:Object(He.jsx)(Jt.a,{defaultChecked:le.getState().config.data.settings_async,onChange:function(e){var t=le.getState().config;t.data.settings_async=e.target.checked,t.save(),le.dispatch(ge(t))}})})]}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){return u(!0)},children:Object(He.jsx)(st.a,{primary:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"})}),Object(He.jsx)(fe.a,{button:!0,onClick:function(){return b(!0)},children:Object(He.jsx)(st.a,{primary:"\u5220\u9664\u6240\u6709\u6570\u636e"})})]}),Object(He.jsx)(Ht,{data:le.getState().user,open:g,keyNames:{username:"\u7528\u6237\u540d",nick:"\u6635\u79f0",phone:"\u624b\u673a\u53f7",profile:"\u8be6\u7ec6\u4fe1\u606f",state:"\u7528\u6237\u72b6\u6001",created_at:"\u521b\u5efa\u4e8e",updated_at:"\u66f4\u65b0\u4e8e"},title:"\u7528\u6237\u4fe1\u606f",onClose:function(){v(!1)}}),Object(He.jsxs)(de.a,{open:o,onClose:function(){return u(!1)},children:[Object(He.jsx)(je.a,{children:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"}),Object(He.jsx)(he.a,{children:Object(He.jsx)(k.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u6240\u6709\u8bbe\u7f6e\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(He.jsxs)(Oe.a,{children:[Object(He.jsx)(xe.a,{onClick:function(){return u(!1)},children:"\u53d6\u6d88"}),Object(He.jsx)(xe.a,{onClick:function(){y(),window.location.reload()},children:"\u786e\u5b9a"})]})]}),Object(He.jsxs)(de.a,{open:h,onClose:function(){return b(!1)},children:[Object(He.jsx)(je.a,{children:"\u5220\u9664\u6240\u6709\u6570\u636e"}),Object(He.jsx)(he.a,{children:Object(He.jsx)(k.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u8f6f\u4ef6\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(He.jsxs)(Oe.a,{children:[Object(He.jsx)(xe.a,{onClick:function(){return b(!1)},children:"\u53d6\u6d88"}),Object(He.jsx)(xe.a,{onClick:function(){y(),window.location.reload()},children:"\u786e\u5b9a"})]})]})]})},Qt=n(271);var Vt=function(e){var t=e.icon,n=e.primary,a=e.to,r=s.a.useMemo((function(){return s.a.forwardRef((function(e,t){return Object(He.jsx)(Q.b,Object(j.a)({to:a,ref:t},e))}))}),[a]);return Object(He.jsx)("li",{children:Object(He.jsxs)(fe.a,{button:!0,component:r,children:[t?Object(He.jsx)(Qt.a,{children:t}):null,Object(He.jsx)(st.a,{primary:n})]})})};function Xt(e){var t=s.a.useState(null),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useState(!1),u=Object(d.a)(o,2),l=u[0],j=u[1],h=s.a.useState(null),b=Object(d.a)(h,2),f=b[0],O=b[1],x=we();console.log("query",x);var p=function(){var e=Object(c.a)(r.a.mark((function e(t,n,a){var c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t,n,a),e.next=3,Ye.request("search","GET",{key:t,src:n});case 3:c=e.sent,console.log(c),i(c.data);case 6:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();return 2!==x.length||l||(p(x[0][1],x[1][1]),j(!0),O({key:x[0][1],src:x[1][1]})),Object(He.jsxs)(Ne.a,{children:[Object(He.jsx)(ut,{defaultValue:f,onSearch:p}),a?Object(He.jsx)(At,{result:a.search}):null]})}var Zt=n(69),Yt=n(121),$t=n.n(Yt);function en(e){var t=Zt.secretkey,n=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}(function(e){for(var t=e.words,n=e.sigBytes,a=new Uint8Array(n),r=0;r<n;r++)a[r]=t[r>>>2]>>>24-r%4*8&255;return a}($t.a.HmacSHA1(e,t)));return window.btoa(n)}var tn=function(){function e(){Object(te.a)(this,e),e.instance||(this.audioContext=null,e.instance=this,this.stream=null)}return Object(ne.a)(e,[{key:"start",value:function(){var e=this;if(this.audioContext)this.OnError("\u5f55\u97f3\u5df2\u5f00\u542f");else{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;try{if(this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioContext.resume(),!this.audioContext)return void this.OnError("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301webAudioApi\u76f8\u5173\u63a5\u53e3")}catch(a){if(!this.audioContext)return void this.OnError("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301webAudioApi\u76f8\u5173\u63a5\u53e3")}if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){t(e)})).catch((function(e){n(e)}));else{if(!navigator.getUserMedia)return navigator.userAgent.toLowerCase().match(/chrome/)&&window.location.origin.indexOf("https://")<0?this.OnError("chrome\u4e0b\u83b7\u53d6\u6d4f\u89c8\u5668\u5f55\u97f3\u529f\u80fd\uff0c\u56e0\u4e3a\u5b89\u5168\u6027\u95ee\u9898\uff0c\u9700\u8981\u5728localhost\u6216127.0.0.1\u6216https\u4e0b\u624d\u80fd\u83b7\u53d6\u6743\u9650"):this.OnError("\u65e0\u6cd5\u83b7\u53d6\u6d4f\u89c8\u5668\u5f55\u97f3\u529f\u80fd\uff0c\u8bf7\u5347\u7ea7\u6d4f\u89c8\u5668\u6216\u4f7f\u7528chrome"),void(this.audioContext&&this.audioContext.close());navigator.getUserMedia({audio:!0,video:!1},(function(e){t(e)}),(function(e){n(e)}))}var t=function(t){e.stream=t;var n=e.audioContext.createMediaStreamSource(t),a=e.audioContext.createScriptProcessor(0,1,1);a.onaudioprocess=function(t){var n=function(e){for(var t=2*e.length,n=new ArrayBuffer(t),a=new DataView(n),r=0,c=0;c<e.length;c++,r+=2){var i=Math.max(-1,Math.min(1,e[c]));a.setInt16(r,i<0?32768*i:32767*i,!0)}return a}(function(e){var t=new Float32Array(e),n=Math.round(t.length*(16e3/44100)),a=new Float32Array(n),r=(t.length-1)/(n-1);a[0]=t[0];for(var c=1;c<n-1;c++){var i=c*r,s=Math.floor(i).toFixed(),o=Math.ceil(i).toFixed(),u=i-s;a[c]=t[s]+(t[o]-t[s])*u}return a[n-1]=t[t.length-1],a}(t.inputBuffer.getChannelData(0)));e.OnReceivedData(n.buffer)},n.connect(a),a.connect(e.audioContext.destination)},n=function(t){e.OnError(t),e.stop()}}}},{key:"stop",value:function(){/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)||this.audioContext&&this.audioContext.suspend(),this.audioContext&&this.audioContext.suspend(),this.stream&&(this.stream.getTracks().map((function(e){return e.stop()})),this.stream=null)}},{key:"OnReceivedData",value:function(e){}},{key:"OnError",value:function(e){console.error(e)}}]),e}();window&&(window.WebRecorder=tn);var nn=function(){function e(t){Object(te.a)(this,e),this.config={appid:t.appid,secretid:t.secretid},this.query=t||null}return Object(ne.a)(e,[{key:"formatSignString",value:function(e){var t="",n="asr.cloud.tencent.com/asr/v2/";this.config.appid&&(n+=this.config.appid);var a=Object.keys(e);for(var r in a.sort(),a)t+="&".concat(a[r],"=").concat(e[a[r]]);return"".concat(n,"?").concat(t.slice(1))}},{key:"createQuery",value:function(){var e=Object(c.a)(r.a.mark((function e(){var t,n,a,i,s,o;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(){return(s=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){try{var n=new XMLHttpRequest;n.open("GET","https://asr.cloud.tencent.com/server_time",!0),n.send(),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&e(n.responseText)}}catch(a){t(a)}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},i=function(){return s.apply(this,arguments)},t={},n=(new Date).getTime(),a=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.next=7,i();case 7:return o=e.sent,t.secretid=this.config.secretid||"",t.engine_model_type=this.query.engine_model_type||"16k_zh",t.timestamp=parseInt(o)||Math.round(n/1e3),t.expired=Math.round(n/1e3)+86400,t.nonce=Math.round(n/1e5),t.voice_id=a(),this.query.hasOwnProperty("voice_format")&&(t.voice_format=this.query.voice_format),this.query.hasOwnProperty("hotword_id")&&(t.hotword_id=this.query.hotword_id),this.query.hasOwnProperty("needvad")&&(t.needvad=this.query.needvad),this.query.hasOwnProperty("filter_dirty")&&(t.filter_dirty=this.query.filter_dirty),this.query.hasOwnProperty("filter_modal")&&(t.filter_modal=this.query.filter_modal),this.query.hasOwnProperty("filter_punc")&&(t.filter_punc=this.query.filter_punc),this.query.hasOwnProperty("convert_num_mode")&&(t.convert_num_mode=this.query.convert_num_mode),this.query.hasOwnProperty("word_info")&&(t.word_info=this.query.word_info),this.query.hasOwnProperty("vad_silence_time")&&(t.vad_silence_time=this.query.vad_silence_time),e.abrupt("return",t);case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getSignStr",value:function(){var e=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.createQuery();case 2:return t=e.sent,e.abrupt("return",this.formatSignString(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),an=function(){function e(t){Object(te.a)(this,e),this.appid=t.appid||"",this.secretid=t.secretid||"",this.socket=null,this.isSignSuccess=!1,this.isSentenceBegin=!1,this.query=Object(j.a)({},t),this.signCallback=t.signCallback||null,this.isRecognizeComplete=!1}return Object(ne.a)(e,[{key:"stop",value:function(){this.socket&&1===this.socket.readyState?this.socket.send(JSON.stringify({type:"end"})):(this.OnError("\u8fde\u63a5\u672a\u5efa\u7acb\u6216\u8fde\u63a5\u5df2\u5173\u95ed"),this.socket&&1===this.socket.readyState?this.socket.close():this.OnError("Cannot close socket!"))}},{key:"getUrl",value:function(){var e=Object(c.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.appid&&this.secretid){e.next=3;break}return this.OnError("\u8bf7\u786e\u8ba4\u662f\u5426\u586b\u5165appid\u548csecretid"),e.abrupt("return",!1);case 3:return t=new nn(this.query),e.next=6,t.getSignStr();case 6:return n=e.sent,e.abrupt("return","".concat(n,"&signature=").concat(encodeURIComponent(this.signCallback(n))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"start",value:function(){var e=Object(c.a)(r.a.mark((function e(){var t,n,a=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getUrl();case 2:if(t=e.sent){e.next=6;break}return this.OnError("\u9274\u6743\u5931\u8d25"),e.abrupt("return");case 6:if(n=this,!("WebSocket"in window)){e.next=11;break}this.socket=new WebSocket("wss://".concat(t)),e.next=17;break;case 11:if(!("MozWebSocket"in window)){e.next=15;break}this.socket=new window.MozWebSocket("wss://".concat(t)),e.next=17;break;case 15:return this.OnError("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301WebSocket"),e.abrupt("return");case 17:this.socket.onopen=function(e){},this.socket.onmessage=function(e){var t=JSON.parse(e.data);if(0!==t.code)return a.OnError(t.message),void n.socket.close();if(a.isSignSuccess||(a.OnRecognitionStart(t),a.isSignSuccess=!0),1===t.final)return a.isRecognizeComplete=!0,void a.OnRecognitionComplete(t);if(t.result){var r=Object(j.a)(Object(j.a)({},t.result),{},{voice_id:t.voice_id});0===t.result.slice_type?(a.OnSentenceBegin(r),a.isSentenceBegin=!0):2===t.result.slice_type?(a.isSentenceBegin||a.OnSentenceBegin(r),a.OnSentenceEnd(r)):a.OnRecognitionResultChange(r)}},this.socket.onerror=function(e){a.socket.close(),a.OnError(e)},this.socket.onclose=function(e){a.isRecognizeComplete||a.OnError(e)};case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(e){this.socket&&1===this.socket.readyState?this.socket.send(e):this.OnError("\u8fde\u63a5\u672a\u5efa\u7acb\uff0c\u8bf7\u7a0d\u540e\u53d1\u9001\u6570\u636e\uff01")}},{key:"OnRecognitionStart",value:function(e){}},{key:"OnSentenceBegin",value:function(e){}},{key:"OnRecognitionResultChange",value:function(){}},{key:"OnSentenceEnd",value:function(){}},{key:"OnRecognitionComplete",value:function(){}},{key:"OnError",value:function(){}}]),e}();window&&(window.SpeechRecognizer=an);var rn=function(){function e(t){Object(te.a)(this,e),this.params=t,this.recorder=null,this.speechRecognizer=null,this.isCanSendData=!1}return Object(ne.a)(e,[{key:"start",value:function(){var e=this;this.recorder=new tn,this.recorder.OnReceivedData=function(t){e.isCanSendData&&e.speechRecognizer.write(t)},this.recorder.OnError=function(t){e.stop(),e.OnError(t)},this.recorder.start(),this.speechRecognizer||(this.speechRecognizer=new an(this.params)),this.speechRecognizer.OnRecognitionStart=function(t){e.OnRecognitionStart(t),e.isCanSendData=!0},this.speechRecognizer.OnSentenceBegin=function(t){e.OnSentenceBegin(t)},this.speechRecognizer.OnRecognitionResultChange=function(t){e.OnRecognitionResultChange(t)},this.speechRecognizer.OnSentenceEnd=function(t){e.OnSentenceEnd(t)},this.speechRecognizer.OnRecognitionComplete=function(t){e.OnRecognitionComplete(t),e.isCanSendData=!1},this.speechRecognizer.OnError=function(t){e.OnError(t),e.recorder.stop(),e.isCanSendData=!1},this.speechRecognizer.start()}},{key:"stop",value:function(){this.recorder&&this.recorder.stop(),this.speechRecognizer&&this.speechRecognizer.stop()}},{key:"OnRecognitionStart",value:function(e){}},{key:"OnSentenceBegin",value:function(e){}},{key:"OnRecognitionResultChange",value:function(){}},{key:"OnSentenceEnd",value:function(){}},{key:"OnRecognitionComplete",value:function(){}},{key:"OnError",value:function(){}}]),e}();window&&(window.WebAudioSpeechRecognizer=rn);n(191);function cn(e){var t=e.user;return t?Object(He.jsxs)("div",{children:[Object(He.jsx)(k.a,{variant:"h4",children:t.nick||t.username}),Object(He.jsxs)(k.a,{variant:"body2",children:["\u7528\u6237\u540d: ",t.username]})]}):null}function sn(e){var t=e.to,n=e.onClose,a=Ie(t),i=s.a.useState(""),o=Object(d.a)(i,2),u=o[0],l=o[1],j=s.a.useState(!1),h=Object(d.a)(j,2),b=h[0],f=h[1],O=s.a.useReducer((function(e){return e+1}),0),x=Object(d.a)(O,2),p=(x[0],x[1]);return t?(a||b||(f(!0),Ye.request("user/".concat(t),"GET").then((function(e){Me(e.data.user),p()}))),Object(He.jsxs)(de.a,{open:!!t,onClose:n,children:[Object(He.jsxs)(je.a,{children:["\u5411 ",a&&a.username||t," \u53d1\u9001\u79c1\u4fe1"]}),Object(He.jsxs)(he.a,{children:[Object(He.jsx)(cn,{user:a}),Object(He.jsx)(ct.a,{multiline:!0,fullWidth:!0,value:u,onChange:function(e){return l(e.target.value)}}),Object(He.jsx)("br",{}),Object(He.jsx)("br",{}),Object(He.jsx)(xe.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ye.request("square/messages","POST",{to_uid:t,content:u});case 2:le.dispatch(ye("\u53d1\u9001\u6210\u529f\uff01")),n&&n();case 4:case"end":return e.stop()}}),e)}))),children:"\u53d1\u9001"})]})]})):null}function on(e){var t=s.a.useState(!1),n=Object(d.a)(t,2),a=n[0],r=n[1],c=s.a.useState(null),i=Object(d.a)(c,2),o=i[0],u=i[1];return a||(r(!0),Ye.request("square/book_list","GET").then((function(e){u(e.data.book_lists)}))),o?Object(He.jsx)(m.a,{children:o.map((function(e,t){return Object(He.jsxs)(fe.a,{button:!0,children:[Object(He.jsxs)(k.a,{variant:"body1",children:[e.list_name,": "]}),Object(He.jsx)(k.a,{variant:"body2",children:e.book_title})]})}))}):Object(He.jsx)(Ze.a,{})}function un(e){var t=le.getState().user,n=s.a.useState(null),a=Object(d.a)(n,2),r=a[0],c=a[1],i=s.a.useState(null),o=Object(d.a)(i,2),u=o[0],j=o[1],h=s.a.useState(!1),b=Object(d.a)(h,2),f=b[0],O=b[1],x=function(){var e,t=we(),n={},a=Object(l.a)(t);try{for(a.s();!(e=a.n()).done;){var r=e.value;n[r[0]]=r[1]}}catch(c){a.e(c)}finally{a.f()}return n}(),p=s.a.useState(x.message_to),g=Object(d.a)(p,2),v=g[0],y=g[1];f||(O(!0),Ye.request("square/messages","GET").then((function(e){c(e.data.messages.received),j(e.data.messages.sent)})));var S=r&&u&&Object(He.jsxs)(m.a,{children:[Object(He.jsx)(fe.a,{children:Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u53d1\u9001\u7684\u6d88\u606f:"})}),Object(He.jsx)(_.a,{}),u.map((function(e,t){return Object(He.jsxs)(fe.a,{button:!0,children:[Object(He.jsxs)(k.a,{variant:"h5",children:[Ie(e.to_uid)&&Ie(e.to_uid).username||e.to_uid,": "]}),Object(He.jsx)(k.a,{variant:"body1",children:e.content})]},e.created_at)})),Object(He.jsx)(fe.a,{children:Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u63a5\u6536\u5230\u7684\u6d88\u606f:"})}),Object(He.jsx)(_.a,{}),r.map((function(e,t){return Object(He.jsxs)(fe.a,{button:!0,children:[Object(He.jsxs)(k.a,{variant:"h5",children:[Ie(e.uid)&&Ie(e.uid).username||e.uid,": "]}),Object(He.jsx)(k.a,{variant:"body1",children:e.content})]},e.created_at)}))]});return Object(He.jsxs)(He.Fragment,{children:[f&&!u?Object(He.jsx)(Ze.a,{}):null,Object(He.jsxs)(m.a,{children:[Object(He.jsx)(fe.a,{children:Object(He.jsx)(cn,{user:t})}),Object(He.jsx)(fe.a,{children:Object(He.jsx)(k.a,{variant:"body2",color:"textSecondary",children:"\u6211\u7684\u4e66\u5355"})}),Object(He.jsx)(_.a,{})]}),Object(He.jsx)(on,{}),S,Object(He.jsx)(sn,{to:v,onClose:function(){O(!1),y(null)}})]})}var ln=240,dn=Object(f.a)((function(e){return{root:{display:"flex",width:"100%"},appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},title:{flexGrow:1},appBarShift:{marginLeft:ln,width:"calc(100% - ".concat(ln,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},hide:{display:"none"},drawer:{width:ln,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:ln,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(h.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)}),toolbar:Object(j.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3),width:"100%",overflowX:"auto"}}})),jn={},hn={config:null,user:null,daemon:null};le.subscribe(Object(c.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=le.getState()).config.data){e.next=11;break}if(JSON.stringify(t.config.data)==JSON.stringify(hn.config)){e.next=10;break}if(console.log("Config will change:",t.config.data),t.config.save(),!le.getState().user||!le.getState().config.data.settings_async){e.next=8;break}return e.next=8,Ye.request("sync","POST",{config:t.config.data});case 8:e.next=10;break;case 10:hn.config=t.config.data;case 11:for(n in jn)jn[n](t);case 12:case"end":return e.stop()}}),e)}))));var bn=!1,fn=!1;var On=function(){var e,t,n=dn(),a=Object(O.a)(),i=s.a.useState(!1),o=Object(d.a)(i,2),u=o[0],j=o[1],f=s.a.useState(!1),w=Object(d.a)(f,2),E=w[0],T=w[1],M=s.a.useState(null),N=Object(d.a)(M,2),G=N[0],P=N[1],B=s.a.useState("Mayne\u7684\u5927\u56fe\u4e66\u9986"),L=Object(d.a)(B,2),U=L[0],H=(L[1],s.a.useReducer((function(e){return e+1}),0)),X=Object(d.a)(H,2),Z=(X[0],X[1]),Y=s.a.useState(""),$=Object(d.a)(Y,2),ee=$[0],te=$[1],ne=s.a.useState(null),ae=Object(d.a)(ne,2);ae[0],ae[1],s.a.useEffect((function(){var e=function(){var e=window.innerWidth;!u&&e>=800&&j(!0),u&&e<=600&&j(!1)};return window.addEventListener("load",e),window.addEventListener("resize",e),function(){window.removeEventListener("load",e),window.removeEventListener("resize",e)}}));var re=le.getState().config.data.api_token.access_token?!le.getState().config.data.voice_assistant&&null:null;if(window.started=re,!1===re){var ce={signCallback:en,secretid:Zt.secretid,appid:Zt.appid,engine_model_type:"16k_zh",voice_format:1,hotword_id:"08003a00000000000000000000000000",needvad:1,filter_dirty:1,filter_modal:2,filter_punc:0,convert_num_mode:1,word_info:2};if(!window.rec){var ie=new rn(ce);window.rec=ie;!function(e,t){e.OnRecognitionStart=function(e){console.log("\u5f00\u59cb\u8bc6\u522b",e)},e.OnSentenceBegin=function(e){console.log("\u4e00\u53e5\u8bdd\u5f00\u59cb",e),bn=!0,window.startMessage("\u4f60\u8bf4: \u2026\u2026",10)},e.OnRecognitionResultChange=function(e){bn&&window.updateMessage("\u4f60\u8bf4: ".concat(e.voice_text_str))},e.OnSentenceEnd=function(e){!1!==bn?(bn=!1,t(e)):console.warn("recStarted",e)},e.OnRecognitionComplete=function(e){console.log("\u8bc6\u522b\u7ed3\u675f",e)},e.OnError=function(e){console.log("\u8bc6\u522b\u5931\u8d25",e)}}(ie,(function(e){var t=e.voice_text_str;if(console.log("\u4e00\u53e5\u8bdd\u7ed3\u675f",e.voice_text_str,e),window.hideMessage(),0!==t.length){if(!fn&&(fn=!0,!window.blocked)){window.blocked=!0;var n=localStorage.getItem("mayne_tbp_terminal")||ee;Ye.request("ai/tbp","POST",{terminal_id:n,text:t}).then((function(e){var n=e.data.tbp;if(n&&!n.ResponseMessage.GroupList||!n)window.startMessage("\u80fd\u2026\u2026\u518d\u8bf4\u4e00\u904d\u561b\uff1f",10);else{var a,i="",s=Object(l.a)(n.ResponseMessage.GroupList);try{for(s.s();!(a=s.n()).done;){var o=a.value;i+=o.Content}}catch(b){s.e(b)}finally{s.f()}if(Ye.request("ai/tts","GET",{text:i}).then((function(e){if(fn=!1,window.startMessage("\u4f60\u8bf4: ".concat(t,"\n\n").concat(i),10),e.data.tts){var n=e.data.tts;console.log(n);var a=new Audio;a.autoplay="autoplay",a.src="data:audio/wav;base64,"+n.Audio,a.oncanplaythrough=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.play(),t=8*(4*window.atob(n.Audio).length-44)/1024e3*1e3+1e3,console.log("sleep for",t,"ms"),e.next=5,Ce(t);case 5:window.blocked=!1;case 6:case"end":return e.stop()}}),e)})))}})),"COMPLETE"===n.DialogStatus){var u,d=null,j=Object(l.a)(n.SlotInfoList);try{for(j.s();!(u=j.n()).done;){var h=u.value;if("BookTitle"===h.SlotName){d=h.SlotValue;break}}}catch(b){j.e(b)}finally{j.f()}d&&setTimeout((function(){window.location.href="/#/search?key=".concat(d,"&src=local_database")}),2e3)}}}))}}else window.startMessage("\u80fd\u2026\u2026\u518d\u8bf4\u4e00\u904d\u561b\uff1f",10)})),Ye.request("ai/tbp","GET").then((function(e){console.log("GET ai/tbp",e),te(e.data.terminal_id),localStorage.setItem("mayne_tbp_terminal",e.data.terminal_id),ie.start()}))}}jn.Error=function(e){e.errorInfo&&(console.log("Error Hook: ",e.errorInfo),T(e.errorInfo),le.dispatch(me(null)))},jn.Message=function(e){e.message&&(console.log("message: ",e.message),P(e.message),le.dispatch(ye(null)))},jn.User=function(e){e.user&&(JSON.stringify(e.user)!=JSON.stringify(hn.user)&&(console.log("Got user",e.user),Z()),hn.user=e.user)},jn.Daemon=function(e){e.daemon&&(JSON.stringify(e.daemon)!=JSON.stringify(hn.daemon)&&Z(),hn.daemon=e.daemon)};var se=Object(He.jsxs)(Q.a,{children:[Object(He.jsx)(y.a,{}),Object(He.jsx)(g.a,{position:"fixed",className:Object(b.a)(n.appBar,Object(h.a)({},n.appBarShift,u)),children:Object(He.jsxs)(v.a,{children:[Object(He.jsx)(S.a,{color:"inherit","aria-label":"open drawer",onClick:function(){j(!0)},edge:"start",className:Object(b.a)(n.menuButton,Object(h.a)({},n.hide,u)),children:Object(He.jsx)(C.a,{})}),Object(He.jsx)(k.a,{variant:"h6",noWrap:!0,className:n.title,children:U}),Object(He.jsx)(k.a,{variant:"body2",children:"\u8bed\u97f3\u52a9\u624b"}),Object(He.jsx)(Jt.a,{checked:le.getState().config.data.voice_assistant,onChange:function(e){var t=le.getState().config;console.log(e),t.data.voice_assistant=e.target.checked,t.save(),window.location.reload()}})]})}),Object(He.jsxs)(p.a,{variant:"permanent",className:Object(b.a)(n.drawer,(e={},Object(h.a)(e,n.drawerOpen,u),Object(h.a)(e,n.drawerClose,!u),e)),classes:{paper:Object(b.a)((t={},Object(h.a)(t,n.drawerOpen,u),Object(h.a)(t,n.drawerClose,!u),t))},children:[Object(He.jsx)("div",{className:n.toolbar,children:Object(He.jsx)(S.a,{onClick:function(){j(!1)},children:(a.direction,Object(He.jsx)(q.a,{}))})}),Object(He.jsx)(_.a,{}),Object(He.jsxs)(m.a,{onClick:function(){window.innerWidth<600&&j(!1)},children:[Object(He.jsx)(Vt,{to:"/",primary:"\u542f\u52a8\u9875",icon:Object(He.jsx)(F.a,{})}),Object(He.jsx)(Vt,{to:"/search",primary:"\u627e\u4e66",icon:Object(He.jsx)(R.a,{})}),Object(He.jsx)(Vt,{to:"/library",primary:"\u9986\u85cf",icon:Object(He.jsx)(I.a,{})}),Object(He.jsx)(Vt,{to:"/square",primary:"\u5e7f\u573a",icon:Object(He.jsx)(W.a,{})}),Object(He.jsx)(Vt,{to:"/me",primary:"\u6211\u7684",icon:Object(He.jsx)(D.a,{})}),Object(He.jsx)(Vt,{to:"/settings",primary:"\u8bbe\u7f6e",icon:Object(He.jsx)(J.a,{})}),Object(He.jsx)(Vt,{to:"/help",primary:"\u5e2e\u52a9",icon:Object(He.jsx)(z.a,{})}),Object(He.jsx)(Vt,{to:"/about",primary:"\u5173\u4e8e",icon:Object(He.jsx)(A.a,{})})]})]}),Object(He.jsxs)("main",{className:n.content,children:[Object(He.jsx)("div",{className:n.toolbar}),Object(He.jsxs)(V.d,{children:[Object(He.jsx)(V.b,{path:"/",exact:!0,children:Object(He.jsx)(Rt,{})}),Object(He.jsx)(V.b,{path:"/library",exact:!0,children:Object(He.jsx)(Pt,{})}),Object(He.jsx)(V.b,{path:"/search",exact:!0,children:Object(He.jsx)(Xt,{})}),Object(He.jsx)(V.b,{path:"/settings",exact:!1,children:Object(He.jsx)(Kt,{})}),Object(He.jsx)(V.b,{path:"/square",exact:!0,children:Object(He.jsx)(Tt,{})}),Object(He.jsx)(V.b,{path:"/me",exact:!0,children:Object(He.jsx)(un,{})}),Object(He.jsx)(V.b,{path:"/help",exact:!0,children:Object(He.jsx)(Ft,{})}),Object(He.jsx)(V.b,{path:"/about",exact:!0,children:Object(He.jsx)(Lt,{})}),Object(He.jsx)(V.b,{path:"/book_info",exact:!0,children:Object(He.jsx)(Ct,{})})]})]})]});return le.getState().user||(se=le.getState().config.data.api_token.access_token?Object(He.jsx)(k.a,{variant:"body1",children:"\u6b63\u5728\u767b\u5f55..."}):Object(He.jsx)(Nt,{})),Object(He.jsx)("div",{className:n.root,children:Object(He.jsxs)(x.a,{theme:le.getState().config.theme,children:[se,Object(He.jsxs)(de.a,{open:!!E,onClose:function(){T(null)},children:[Object(He.jsx)(je.a,{children:"\u9047\u5230\u9519\u8bef"}),Object(He.jsxs)(he.a,{children:[Object(He.jsx)(k.a,{variant:"body1",children:"\u9519\u8bef\u4fe1\u606f"}),Object(He.jsx)(be.a,{component:"div",children:Object(He.jsx)(be.a,{component:"div",children:function(){return Ee(E)&&"string"!==typeof E?Object(He.jsx)(m.a,{children:E.map((function(e,t){return Object(He.jsx)(fe.a,{children:Object(He.jsx)("code",{children:"{}"===JSON.stringify(e)?e.toString():JSON.stringify(e)})},t)}))}):Object(He.jsx)("code",{children:"{}"===JSON.stringify(E)?E.toString():JSON.stringify(E)})}})})]}),Object(He.jsxs)(Oe.a,{children:[Object(He.jsx)(xe.a,{color:"primary",onClick:function(){window.location.reload()},children:"\u5237\u65b0"}),Object(He.jsx)(xe.a,{color:"primary",onClick:function(){T(null)},children:"\u53d6\u6d88"})]})]}),Object(He.jsx)(pe.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},onClose:function(){return P(null)},open:null!==G,autoHideDuration:4e3,message:G,action:Object(He.jsx)(s.a.Fragment,{children:Object(He.jsx)(S.a,{size:"small","aria-label":"close",color:"inherit",onClick:function(){return P(null)},children:Object(He.jsx)(K.a,{fontSize:"small"})})})})]})})},xn=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,286)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};function pn(){return(pn=Object(c.a)(r.a.mark((function e(){var t,n=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:1e3;case 1:return e.next=5,Ce(t);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gn(){return(gn=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(c.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=le.getState().user,!(!t&&le.getState().config.data.api_token.access_token)){e.next=8;break}return Ye.load_from_config(),e.next=6,Ye.request("user","GET");case 6:200===(n=e.sent).code&&le.dispatch(ve(n.data.user));case 8:case"end":return e.stop()}}),e)}))),0);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u.a.render(Object(He.jsx)(X.a,{store:le,children:Object(He.jsx)(On,{})}),document.getElementById("root")),function(){return gn.apply(this,arguments)}().then((function(){!function(){pn.apply(this,arguments)}()})),xn()},69:function(e){e.exports=JSON.parse('{"appid":"1254016670","secretid":"AKIDcLqZ6NZBi14sTrTTjkX5OSItEKVSanCc","secretkey":"MWTBhyzmKgm9MM9h04HFyURBfvwlLgnh"}')}},[[192,1,2]]]);
//# sourceMappingURL=main.d916eaae.chunk.js.map